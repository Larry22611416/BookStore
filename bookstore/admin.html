<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³‡æ–™åº«ç®¡ç†å·¥å…· - æ›¸å®¢ä¾†é–‹ç™¼å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", "å¾®è»Ÿé›…é»‘", Arial, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }

        /* é ‚éƒ¨å°èˆª */
        .top-nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav-title {
            font-size: 24px;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .nav-link:hover {
            background-color: rgba(255,255,255,0.2);
        }

        /* ä¸»è¦å…§å®¹ */
        .main-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        /* è­¦å‘Šæç¤º */
        .warning-banner {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .warning-icon {
            font-size: 24px;
            color: #e17055;
        }

        .warning-text {
            color: #856404;
        }

        /* ç‹€æ…‹å¡ç‰‡ */
        .status-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 5px solid #4CAF50;
        }

        .status-card.error {
            border-left-color: #f44336;
        }

        .status-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .status-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .status-value.error {
            color: #f44336;
        }

        .status-description {
            font-size: 14px;
            color: #666;
        }

        /* å·¥å…·é¢æ¿ */
        .tool-panel {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .panel-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }

        /* æŒ‰éˆ•çµ„ */
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .tool-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-btn.primary {
            background-color: #4CAF50;
            color: white;
        }

        .tool-btn.primary:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        .tool-btn.secondary {
            background-color: #2196F3;
            color: white;
        }

        .tool-btn.secondary:hover {
            background-color: #1976D2;
            transform: translateY(-2px);
        }

        .tool-btn.warning {
            background-color: #ff9800;
            color: white;
        }

        .tool-btn.warning:hover {
            background-color: #f57c00;
            transform: translateY(-2px);
        }

        .tool-btn.danger {
            background-color: #f44336;
            color: white;
        }

        .tool-btn.danger:hover {
            background-color: #d32f2f;
            transform: translateY(-2px);
        }

        .tool-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* è³‡æ–™è¡¨æ ¼ */
        .data-table-container {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-height: 500px;
            overflow-y: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .data-table th {
            background-color: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid #e9ecef;
            position: sticky;
            top: 0;
        }

        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }

        .data-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .data-cell-email {
            color: #4CAF50;
            font-weight: bold;
        }

        .data-cell-date {
            color: #666;
            font-size: 12px;
        }

        .data-cell-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            white-space: nowrap;
        }

        .status-active {
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        .status-processing {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .status-completed {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        /* æ—¥èªŒå€åŸŸ */
        .log-container {
            background-color: #1e1e1e;
            color: #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-title {
            color: #4CAF50;
            font-weight: bold;
            margin-bottom: 15px;
            font-family: inherit;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-timestamp {
            color: #888;
            font-size: 12px;
        }

        .log-level-info {
            color: #2196F3;
        }

        .log-level-success {
            color: #4CAF50;
        }

        .log-level-warning {
            color: #ff9800;
        }

        .log-level-error {
            color: #f44336;
        }

        /* è¼‰å…¥æŒ‡ç¤ºå™¨ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-content {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 15px;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-container {
                padding: 0 10px;
            }

            .status-container {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .tool-btn {
                justify-content: center;
            }

            .data-table-container {
                padding: 15px;
            }

            .data-table {
                font-size: 12px;
            }

            .data-table th,
            .data-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- é ‚éƒ¨å°èˆª -->
    <div class="top-nav">
        <div class="nav-container">
            <div class="nav-title">ğŸ› ï¸ æ›¸å®¢ä¾†è³‡æ–™åº«ç®¡ç†å·¥å…·</div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">ğŸ“š å›åˆ°æ›¸åº—</a>
                <a href="login.html" class="nav-link">ğŸ”‘ ç™»å…¥é é¢</a>
                <a href="register.html" class="nav-link">ğŸ“ è¨»å†Šé é¢</a>
                <a href="shopping.html" class="nav-link">ğŸ›’ è³¼ç‰©è»Š</a>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹ -->
    <div class="main-container">
        <!-- è­¦å‘Šæç¤º -->
        <div class="warning-banner">
            <div class="warning-icon">âš ï¸</div>
            <div class="warning-text">
                <strong>é–‹ç™¼å·¥å…·è­¦å‘Šï¼š</strong>æ­¤é é¢åƒ…ä¾›é–‹ç™¼å’Œæ¸¬è©¦ä½¿ç”¨ã€‚åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œè«‹å‹¿æš´éœ²æ­¤ç®¡ç†å·¥å…·çµ¦ä¸€èˆ¬ç”¨æˆ¶ã€‚
                æ‰€æœ‰è³‡æ–™åº«æ“ä½œéƒ½æœƒå½±éŸ¿ç³»çµ±ç‹€æ…‹ï¼Œè«‹è¬¹æ…ä½¿ç”¨ã€‚
            </div>
        </div>

        <!-- è³‡æ–™åº«ç‹€æ…‹ -->
        <div class="status-container">
            <div class="status-card" id="dbStatusCard">
                <div class="status-title">ğŸ“Š è³‡æ–™åº«ç‹€æ…‹</div>
                <div class="status-value" id="dbStatusValue">è¼‰å…¥ä¸­...</div>
                <div class="status-description" id="dbStatusDesc">æ­£åœ¨æª¢æŸ¥è³‡æ–™åº«é€£ç·š</div>
            </div>
            <div class="status-card">
                <div class="status-title">ğŸ‘¥ ç”¨æˆ¶ç¸½æ•¸</div>
                <div class="status-value" id="userCountValue">0</div>
                <div class="status-description">å·²è¨»å†Šçš„æœƒå“¡æ•¸é‡</div>
            </div>
            <div class="status-card">
                <div class="status-title">ğŸ“¦ è¨‚å–®ç¸½æ•¸</div>
                <div class="status-value" id="orderCountValue">0</div>
                <div class="status-description">ç³»çµ±ä¸­çš„è¨‚å–®æ•¸é‡</div>
            </div>
            <div class="status-card">
                <div class="status-title">ğŸ’° ç¸½éŠ·å”®é¡</div>
                <div class="status-value" id="totalSalesValue">$0</div>
                <div class="status-description">ç´¯è¨ˆéŠ·å”®é‡‘é¡</div>
            </div>
        </div>

        <!-- è³‡æ–™åº«æ“ä½œå·¥å…· -->
        <div class="tool-panel">
            <div class="panel-title">ğŸ”§ è³‡æ–™åº«æ“ä½œ</div>
            <div class="button-group">
                <button class="tool-btn primary" onclick="refreshStatus()">
                    ğŸ”„ é‡æ–°æ•´ç†ç‹€æ…‹
                </button>
                <button class="tool-btn secondary" onclick="initTestData()">
                    ğŸ§ª åˆå§‹åŒ–æ¸¬è©¦è³‡æ–™
                </button>
                <button class="tool-btn warning" onclick="exportData()">
                    ğŸ“¤ åŒ¯å‡ºè³‡æ–™
                </button>
                <button class="tool-btn warning" onclick="importData()">
                    ğŸ“¥ åŒ¯å…¥è³‡æ–™
                </button>
                <button class="tool-btn danger" onclick="clearDatabase()">
                    ğŸ—‘ï¸ æ¸…ç©ºè³‡æ–™åº«
                </button>
            </div>
        </div>

        <!-- ç”¨æˆ¶ç®¡ç† -->
        <div class="tool-panel">
            <div class="panel-title">ğŸ‘¥ ç”¨æˆ¶ç®¡ç†</div>
            <div class="button-group">
                <button class="tool-btn primary" onclick="loadUsers()">
                    ğŸ“‹ è¼‰å…¥ç”¨æˆ¶åˆ—è¡¨
                </button>
                <button class="tool-btn secondary" onclick="createTestUser()">
                    â• å‰µå»ºæ¸¬è©¦ç”¨æˆ¶
                </button>
            </div>
            <div class="data-table-container" id="usersTableContainer" style="display: none;">
                <table class="data-table" id="usersTable">
                    <thead>
                        <tr>
                            <th>ç”¨æˆ¶ID</th>
                            <th>é›»å­éƒµä»¶</th>
                            <th>å§“å</th>
                            <th>è¨»å†Šæ™‚é–“</th>
                            <th>ç‹€æ…‹</th>
                            <th>æœ€å¾Œç™»å…¥</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- è¨‚å–®ç®¡ç† -->
        <div class="tool-panel">
            <div class="panel-title">ğŸ“¦ è¨‚å–®ç®¡ç†</div>
            <div class="button-group">
                <button class="tool-btn primary" onclick="loadOrders()">
                    ğŸ“‹ è¼‰å…¥è¨‚å–®åˆ—è¡¨
                </button>
                <button class="tool-btn secondary" onclick="createTestOrder()">
                    â• å‰µå»ºæ¸¬è©¦è¨‚å–®
                </button>
            </div>
            <div class="data-table-container" id="ordersTableContainer" style="display: none;">
                <table class="data-table" id="ordersTable">
                    <thead>
                        <tr>
                            <th>è¨‚å–®ç·¨è™Ÿ</th>
                            <th>ç”¨æˆ¶éƒµä»¶</th>
                            <th>è¨‚å–®é‡‘é¡</th>
                            <th>ä»˜æ¬¾æ–¹å¼</th>
                            <th>è¨‚å–®ç‹€æ…‹</th>
                            <th>è¨‚è³¼æ™‚é–“</th>
                            <th>å•†å“æ•¸é‡</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- æ“ä½œæ—¥èªŒ -->
        <div class="log-container">
            <div class="log-title">ğŸ“ æ“ä½œæ—¥èªŒ</div>
            <div id="logContent">
                <div class="log-entry">
                    <span class="log-timestamp">[å•Ÿå‹•]</span>
                    <span class="log-level-info">è³‡æ–™åº«ç®¡ç†å·¥å…·å·²è¼‰å…¥</span>
                </div>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥æŒ‡ç¤ºå™¨ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨è™•ç†è«‹æ±‚...</p>
        </div>
    </div>

    <!-- è³‡æ–™åº«ç®¡ç†ç³»çµ± -->
    <script src="js/database.js"></script>
    <script>
        // è³‡æ–™åº«ç®¡ç†å·¥å…·é¡
        class DatabaseAdminTool {
            constructor() {
                this.isReady = false;
                this.init();
            }

            async init() {
                console.log('ğŸ› ï¸ åˆå§‹åŒ–è³‡æ–™åº«ç®¡ç†å·¥å…·');
                
                // ç­‰å¾…è³‡æ–™åº«æº–å‚™å°±ç·’
                if (window.bookstoreDB && window.bookstoreDB.db) {
                    this.isReady = true;
                    await this.refreshStatus();
                } else {
                    // ç›£è½è³‡æ–™åº«å°±ç·’äº‹ä»¶
                    window.addEventListener('databaseReady', async () => {
                        this.isReady = true;
                        await this.refreshStatus();
                    });
                }
                
                this.addLog('info', 'ç®¡ç†å·¥å…·åˆå§‹åŒ–å®Œæˆ');
            }

            // é‡æ–°æ•´ç†ç‹€æ…‹
            async refreshStatus() {
                if (!this.isReady) {
                    this.addLog('error', 'è³‡æ–™åº«å°šæœªæº–å‚™å°±ç·’');
                    this.updateDbStatus('error', 'æœªé€£ç·š', 'è³‡æ–™åº«å°šæœªæº–å‚™å°±ç·’');
                    return;
                }

                try {
                    this.addLog('info', 'æ­£åœ¨æª¢æŸ¥è³‡æ–™åº«ç‹€æ…‹...');
                    
                    const status = await window.bookstoreDB.checkDatabaseStatus();
                    
                    if (status.isConnected) {
                        this.updateDbStatus('success', 'å·²é€£ç·š', 'è³‡æ–™åº«é‹ä½œæ­£å¸¸');
                        
                        // æ›´æ–°çµ±è¨ˆè³‡æ–™
                        document.getElementById('userCountValue').textContent = status.userCount;
                        document.getElementById('orderCountValue').textContent = status.orderCount;
                        
                        // è¨ˆç®—ç¸½éŠ·å”®é¡
                        const orders = await window.bookstoreDB.getAllOrders();
                        const totalSales = orders.reduce((sum, order) => sum + order.totalAmount, 0);
                        document.getElementById('totalSalesValue').textContent = `$${totalSales.toLocaleString()}`;
                        
                        this.addLog('success', `ç‹€æ…‹æ›´æ–°å®Œæˆ - ç”¨æˆ¶: ${status.userCount}, è¨‚å–®: ${status.orderCount}, éŠ·å”®é¡: $${totalSales.toLocaleString()}`);
                    } else {
                        this.updateDbStatus('error', 'é€£ç·šå¤±æ•—', status.error || 'æœªçŸ¥éŒ¯èª¤');
                        this.addLog('error', 'è³‡æ–™åº«é€£ç·šå¤±æ•—: ' + (status.error || 'æœªçŸ¥éŒ¯èª¤'));
                    }
                } catch (error) {
                    console.error('âŒ æª¢æŸ¥è³‡æ–™åº«ç‹€æ…‹å¤±æ•—:', error);
                    this.updateDbStatus('error', 'æª¢æŸ¥å¤±æ•—', error.message);
                    this.addLog('error', 'æª¢æŸ¥è³‡æ–™åº«ç‹€æ…‹å¤±æ•—: ' + error.message);
                }
            }

            // æ›´æ–°è³‡æ–™åº«ç‹€æ…‹é¡¯ç¤º
            updateDbStatus(type, status, description) {
                const card = document.getElementById('dbStatusCard');
                const valueElement = document.getElementById('dbStatusValue');
                const descElement = document.getElementById('dbStatusDesc');
                
                if (type === 'error') {
                    card.classList.add('error');
                    valueElement.classList.add('error');
                } else {
                    card.classList.remove('error');
                    valueElement.classList.remove('error');
                }
                
                valueElement.textContent = status;
                descElement.textContent = description;
            }

            // åˆå§‹åŒ–æ¸¬è©¦è³‡æ–™
            async initTestData() {
                if (!this.isReady) {
                    alert('è³‡æ–™åº«å°šæœªæº–å‚™å°±ç·’');
                    return;
                }

                if (!confirm('ç¢ºå®šè¦åˆå§‹åŒ–æ¸¬è©¦è³‡æ–™å—ï¼Ÿé€™å°‡å‰µå»ºé è¨­çš„æ¸¬è©¦ç”¨æˆ¶å’Œè¨‚å–®ã€‚')) {
                    return;
                }

                this.showLoading(true);
                this.addLog('info', 'é–‹å§‹åˆå§‹åŒ–æ¸¬è©¦è³‡æ–™...');

                try {
                    await window.bookstoreDB.initTestData();
                    this.addLog('success', 'æ¸¬è©¦è³‡æ–™åˆå§‹åŒ–å®Œæˆ');
                    await this.refreshStatus();
                    alert('âœ… æ¸¬è©¦è³‡æ–™åˆå§‹åŒ–æˆåŠŸï¼');
                } catch (error) {
                    console.error('âŒ åˆå§‹åŒ–æ¸¬è©¦è³‡æ–™å¤±æ•—:', error);
                    this.addLog('error', 'åˆå§‹åŒ–æ¸¬è©¦è³‡æ–™å¤±æ•—: ' + error.message);
                    alert('âŒ åˆå§‹åŒ–å¤±æ•—: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // æ¸…ç©ºè³‡æ–™åº«
            async clearDatabase() {
                if (!this.isReady) {
                    alert('è³‡æ–™åº«å°šæœªæº–å‚™å°±ç·’');
                    return;
                }

                const confirmText = 'æ¸…ç©ºè³‡æ–™åº«';
                const userInput = prompt(`âš ï¸ å±éšªæ“ä½œè­¦å‘Šï¼\n\né€™å°‡æ¸…ç©ºæ‰€æœ‰ç”¨æˆ¶ã€è¨‚å–®å’Œè³¼ç‰©è»Šè³‡æ–™ï¼Œæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚\n\nè«‹è¼¸å…¥ "${confirmText}" ä¾†ç¢ºèªæ“ä½œ:`);
                
                if (userInput !== confirmText) {
                    this.addLog('info', 'æ¸…ç©ºè³‡æ–™åº«æ“ä½œå·²å–æ¶ˆ');
                    return;
                }

                this.showLoading(true);
                this.addLog('warning', 'é–‹å§‹æ¸…ç©ºè³‡æ–™åº«...');

                try {
                    await window.bookstoreDB.resetAllData();
                    this.addLog('success', 'è³‡æ–™åº«å·²æ¸…ç©ºä¸¦é‡æ–°åˆå§‹åŒ–æ¸¬è©¦è³‡æ–™');
                    await this.refreshStatus();
                    
                    // æ¸…ç©ºè¡¨æ ¼é¡¯ç¤º
                    document.getElementById('usersTableContainer').style.display = 'none';
                    document.getElementById('ordersTableContainer').style.display = 'none';
                    
                    alert('âœ… è³‡æ–™åº«å·²æ¸…ç©ºä¸¦é‡æ–°åˆå§‹åŒ–ï¼');
                } catch (error) {
                    console.error('âŒ æ¸…ç©ºè³‡æ–™åº«å¤±æ•—:', error);
                    this.addLog('error', 'æ¸…ç©ºè³‡æ–™åº«å¤±æ•—: ' + error.message);
                    alert('âŒ æ¸…ç©ºå¤±æ•—: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // è¼‰å…¥ç”¨æˆ¶åˆ—è¡¨
            async loadUsers() {
                if (!this.isReady) {
                    alert('è³‡æ–™åº«å°šæœªæº–å‚™å°±ç·’');
                    return;
                }

                this.showLoading(true);
                this.addLog('info', 'æ­£åœ¨è¼‰å…¥ç”¨æˆ¶åˆ—è¡¨...');

                try {
                    const users = await window.bookstoreDB.getAllUsers();
                    this.displayUsers(users);
                    this.addLog('success', `ç”¨æˆ¶åˆ—è¡¨è¼‰å…¥å®Œæˆï¼Œå…± ${users.length} ä½ç”¨æˆ¶`);
                } catch (error) {
                    console.error('âŒ è¼‰å…¥ç”¨æˆ¶åˆ—è¡¨å¤±æ•—:', error);
                    this.addLog('error', 'è¼‰å…¥ç”¨æˆ¶åˆ—è¡¨å¤±æ•—: ' + error.message);
                    alert('âŒ è¼‰å…¥å¤±æ•—: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // é¡¯ç¤ºç”¨æˆ¶åˆ—è¡¨
            displayUsers(users) {
                const tbody = document.getElementById('usersTableBody');
                const container = document.getElementById('usersTableContainer');
                
                tbody.innerHTML = '';
                
                if (users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #666;">æ²’æœ‰ç”¨æˆ¶è³‡æ–™</td></tr>';
                } else {
                    users.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${user.userId}</td>
                            <td class="data-cell-email">${user.email}</td>
                            <td>${user.name}</td>
                            <td class="data-cell-date">${new Date(user.registrationDate).toLocaleString('zh-TW')}</td>
                            <td><span class="data-cell-status status-active">${user.isActive ? 'æ´»èº' : 'åœç”¨'}</span></td>
                            <td class="data-cell-date">${user.lastLoginDate ? new Date(user.lastLoginDate).toLocaleString('zh-TW') : 'å¾æœªç™»å…¥'}</td>
                        `;
                        tbody.appendChild(row);
                    });
                }
                
                container.style.display = 'block';
            }

            // è¼‰å…¥è¨‚å–®åˆ—è¡¨
            async loadOrders() {
                if (!this.isReady) {
                    alert('è³‡æ–™åº«å°šæœªæº–å‚™å°±ç·’');
                    return;
                }

                this.showLoading(true);
                this.addLog('info', 'æ­£åœ¨è¼‰å…¥è¨‚å–®åˆ—è¡¨...');

                try {
                    const orders = await window.bookstoreDB.getAllOrders();
                    this.displayOrders(orders);
                    this.addLog('success', `è¨‚å–®åˆ—è¡¨è¼‰å…¥å®Œæˆï¼Œå…± ${orders.length} ç­†è¨‚å–®`);
                } catch (error) {
                    console.error('âŒ è¼‰å…¥è¨‚å–®åˆ—è¡¨å¤±æ•—:', error);
                    this.addLog('error', 'è¼‰å…¥è¨‚å–®åˆ—è¡¨å¤±æ•—: ' + error.message);
                    alert('âŒ è¼‰å…¥å¤±æ•—: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // é¡¯ç¤ºè¨‚å–®åˆ—è¡¨
            displayOrders(orders) {
                const tbody = document.getElementById('ordersTableBody');
                const container = document.getElementById('ordersTableContainer');
                
                tbody.innerHTML = '';
                
                if (orders.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #666;">æ²’æœ‰è¨‚å–®è³‡æ–™</td></tr>';
                } else {
                    orders.forEach(order => {
                        const statusClass = {
                            'processing': 'status-processing',
                            'completed': 'status-completed',
                            'shipped': 'status-completed'
                        }[order.status] || 'status-processing';

                        const paymentMethodMap = {
                            'credit_card': 'ä¿¡ç”¨å¡',
                            'atm': 'ATMè½‰å¸³',
                            'convenience_store': 'è¶…å•†å–è²¨ä»˜æ¬¾',
                            'line_pay': 'LINE Pay'
                        };

                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="data-cell-email">${order.orderNumber}</td>
                            <td>${order.userEmail}</td>
                            <td>$${order.totalAmount.toLocaleString()}</td>
                            <td>${paymentMethodMap[order.paymentMethod] || order.paymentMethod}</td>
                            <td><span class="data-cell-status ${statusClass}">${order.statusText}</span></td>
                            <td class="data-cell-date">${new Date(order.orderDate).toLocaleString('zh-TW')}</td>
                            <td>${order.items.length} é …å•†å“</td>
                        `;
                        tbody.appendChild(row);
                    });
                }
                
                container.style.display = 'block';
            }

            // å‰µå»ºæ¸¬è©¦ç”¨æˆ¶
            async createTestUser() {
                if (!this.isReady) {
                    alert('è³‡æ–™åº«å°šæœªæº–å‚™å°±ç·’');
                    return;
                }

                const email = prompt('è«‹è¼¸å…¥æ¸¬è©¦ç”¨æˆ¶çš„é›»å­éƒµä»¶:');
                if (!email) return;

                const name = prompt('è«‹è¼¸å…¥æ¸¬è©¦ç”¨æˆ¶çš„å§“å:') || 'æ¸¬è©¦ç”¨æˆ¶';

                this.showLoading(true);
                this.addLog('info', `æ­£åœ¨å‰µå»ºæ¸¬è©¦ç”¨æˆ¶: ${email}`);

                try {
                    const userData = {
                        email: email.toLowerCase().trim(),
                        password: '123456',
                        name: name,
                        phone: '0912345678',
                        address: 'æ¸¬è©¦åœ°å€'
                    };

                    await window.bookstoreDB.registerUser(userData);
                    this.addLog('success', `æ¸¬è©¦ç”¨æˆ¶å‰µå»ºæˆåŠŸ: ${email}`);
                    await this.refreshStatus();
                    alert('âœ… æ¸¬è©¦ç”¨æˆ¶å‰µå»ºæˆåŠŸï¼\n\nç™»å…¥è³‡è¨Š:\né›»å­éƒµä»¶: ' + email + '\nå¯†ç¢¼: 123456');
                } catch (error) {
                    console.error('âŒ å‰µå»ºæ¸¬è©¦ç”¨æˆ¶å¤±æ•—:', error);
                    this.addLog('error', 'å‰µå»ºæ¸¬è©¦ç”¨æˆ¶å¤±æ•—: ' + error.message);
                    alert('âŒ å‰µå»ºå¤±æ•—: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // å‰µå»ºæ¸¬è©¦è¨‚å–®
            async createTestOrder() {
                if (!this.isReady) {
                    alert('è³‡æ–™åº«å°šæœªæº–å‚™å°±ç·’');
                    return;
                }

                const userEmail = prompt('è«‹è¼¸å…¥ç”¨æˆ¶é›»å­éƒµä»¶ (ç•™ç©ºä½¿ç”¨ test@bookstore.com):') || 'test@bookstore.com';

                this.showLoading(true);
                this.addLog('info', `æ­£åœ¨ç‚ºç”¨æˆ¶ ${userEmail} å‰µå»ºæ¸¬è©¦è¨‚å–®`);

                try {
                    const orderData = {
                        userEmail: userEmail.toLowerCase().trim(),
                        items: [
                            {
                                id: 'test_book_' + Date.now(),
                                title: 'æ¸¬è©¦æ›¸ç± - ' + new Date().toLocaleString(),
                                price: 299,
                                quantity: 1
                            }
                        ],
                        totalAmount: 299,
                        paymentMethod: 'credit_card',
                        shippingAddress: 'æ¸¬è©¦åœ°å€',
                        notes: 'æ¸¬è©¦è¨‚å–® - ç”±ç®¡ç†å·¥å…·å‰µå»º'
                    };

                    const newOrder = await window.bookstoreDB.createOrder(orderData);
                    this.addLog('success', `æ¸¬è©¦è¨‚å–®å‰µå»ºæˆåŠŸ: ${newOrder.orderNumber}`);
                    await this.refreshStatus();
                    alert('âœ… æ¸¬è©¦è¨‚å–®å‰µå»ºæˆåŠŸï¼\n\nè¨‚å–®ç·¨è™Ÿ: ' + newOrder.orderNumber);
                } catch (error) {
                    console.error('âŒ å‰µå»ºæ¸¬è©¦è¨‚å–®å¤±æ•—:', error);
                    this.addLog('error', 'å‰µå»ºæ¸¬è©¦è¨‚å–®å¤±æ•—: ' + error.message);
                    alert('âŒ å‰µå»ºå¤±æ•—: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // åŒ¯å‡ºè³‡æ–™
            async exportData() {
                if (!this.isReady) {
                    alert('è³‡æ–™åº«å°šæœªæº–å‚™å°±ç·’');
                    return;
                }

                this.showLoading(true);
                this.addLog('info', 'æ­£åœ¨åŒ¯å‡ºè³‡æ–™...');

                try {
                    const users = await window.bookstoreDB.getAllUsers();
                    const orders = await window.bookstoreDB.getAllOrders();
                    
                    const exportData = {
                        exportDate: new Date().toISOString(),
                        version: '1.0',
                        users: users,
                        orders: orders
                    };
                    
                    const dataStr = JSON.stringify(exportData, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `bookstore_data_export_${new Date().toISOString().split('T')[0]}.json`;
                    link.click();
                    
                    this.addLog('success', `è³‡æ–™åŒ¯å‡ºå®Œæˆ - ç”¨æˆ¶: ${users.length}, è¨‚å–®: ${orders.length}`);
                    alert('âœ… è³‡æ–™åŒ¯å‡ºå®Œæˆï¼æª”æ¡ˆå·²ä¸‹è¼‰ã€‚');
                } catch (error) {
                    console.error('âŒ åŒ¯å‡ºè³‡æ–™å¤±æ•—:', error);
                    this.addLog('error', 'åŒ¯å‡ºè³‡æ–™å¤±æ•—: ' + error.message);
                    alert('âŒ åŒ¯å‡ºå¤±æ•—: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // åŒ¯å…¥è³‡æ–™
            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    this.showLoading(true);
                    this.addLog('info', 'æ­£åœ¨åŒ¯å…¥è³‡æ–™...');
                    
                    try {
                        const text = await file.text();
                        const data = JSON.parse(text);
                        
                        if (!data.users || !data.orders) {
                            throw new Error('ç„¡æ•ˆçš„è³‡æ–™æ ¼å¼');
                        }
                        
                        // é€™è£¡æ‡‰è©²å¯¦ä½œåŒ¯å…¥é‚è¼¯
                        // ç‚ºäº†ç°¡åŒ–ï¼Œæš«æ™‚åªé¡¯ç¤ºè³‡æ–™çµ±è¨ˆ
                        this.addLog('info', `æº–å‚™åŒ¯å…¥ - ç”¨æˆ¶: ${data.users.length}, è¨‚å–®: ${data.orders.length}`);
                        alert(`ğŸ“Š è³‡æ–™é è¦½:\n\nç”¨æˆ¶æ•¸é‡: ${data.users.length}\nè¨‚å–®æ•¸é‡: ${data.orders.length}\nåŒ¯å‡ºæ—¥æœŸ: ${data.exportDate}\n\nâš ï¸ åŒ¯å…¥åŠŸèƒ½å°šæœªå®Œå…¨å¯¦ä½œï¼Œè«‹æ‰‹å‹•è™•ç†è³‡æ–™ã€‚`);
                        
                        this.addLog('warning', 'åŒ¯å…¥åŠŸèƒ½å°šæœªå®Œå…¨å¯¦ä½œ');
                    } catch (error) {
                        console.error('âŒ åŒ¯å…¥è³‡æ–™å¤±æ•—:', error);
                        this.addLog('error', 'åŒ¯å…¥è³‡æ–™å¤±æ•—: ' + error.message);
                        alert('âŒ åŒ¯å…¥å¤±æ•—: ' + error.message);
                    } finally {
                        this.showLoading(false);
                    }
                };
                input.click();
            }

            // é¡¯ç¤º/éš±è—è¼‰å…¥æŒ‡ç¤ºå™¨
            showLoading(show) {
                const overlay = document.getElementById('loadingOverlay');
                overlay.style.display = show ? 'flex' : 'none';
            }

            // æ·»åŠ æ—¥èªŒ
            addLog(level, message) {
                const logContent = document.getElementById('logContent');
                const timestamp = new Date().toLocaleString('zh-TW');
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `
                    <span class="log-timestamp">[${timestamp}]</span>
                    <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                    <span>${message}</span>
                `;
                
                logContent.appendChild(logEntry);
                
                // ä¿æŒæ—¥èªŒåœ¨åº•éƒ¨
                logContent.scrollTop = logContent.scrollHeight;
                
                // é™åˆ¶æ—¥èªŒæ•¸é‡
                const entries = logContent.querySelectorAll('.log-entry');
                if (entries.length > 100) {
                    entries[0].remove();
                }
            }
        }

        // å‰µå»ºå…¨åŸŸç®¡ç†å·¥å…·å¯¦ä¾‹
        let adminTool;

        // å…¨åŸŸå‡½æ•¸
        function refreshStatus() {
            if (adminTool) adminTool.refreshStatus();
        }

        function initTestData() {
            if (adminTool) adminTool.initTestData();
        }

        function clearDatabase() {
            if (adminTool) adminTool.clearDatabase();
        }

        function loadUsers() {
            if (adminTool) adminTool.loadUsers();
        }

        function loadOrders() {
            if (adminTool) adminTool.loadOrders();
        }

        function createTestUser() {
            if (adminTool) adminTool.createTestUser();
        }

        function createTestOrder() {
            if (adminTool) adminTool.createTestOrder();
        }

        function exportData() {
            if (adminTool) adminTool.exportData();
        }

        function importData() {
            if (adminTool) adminTool.importData();
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ› ï¸ è³‡æ–™åº«ç®¡ç†å·¥å…·è¼‰å…¥å®Œæˆ');
            
            // ç­‰å¾…è³‡æ–™åº«æº–å‚™å°±ç·’å¾Œåˆå§‹åŒ–
            const initAdminTool = () => {
                if (window.bookstoreDB) {
                    adminTool = new DatabaseAdminTool();
                } else {
                    setTimeout(initAdminTool, 100);
                }
            };
            
            initAdminTool();
        });

        // ç›£è½è³‡æ–™åº«äº‹ä»¶
        window.addEventListener('databaseReady', function(e) {
            console.log('ğŸ“Š è³‡æ–™åº«å·²å°±ç·’ï¼Œç®¡ç†å·¥å…·å¯æ­£å¸¸ä½¿ç”¨');
        });

        window.addEventListener('databaseError', function(e) {
            console.warn('âš ï¸ è³‡æ–™åº«ç™¼ç”ŸéŒ¯èª¤ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½ç„¡æ³•æ­£å¸¸ä½¿ç”¨');
        });

        console.log('ğŸ› ï¸ è³‡æ–™åº«ç®¡ç†å·¥å…·è…³æœ¬è¼‰å…¥å®Œæˆ');
    </script>
</body>
</html>