<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë≥áÊñôÂ∫´ÁÆ°ÁêÜÂ∑•ÂÖ∑ - Êõ∏ÂÆ¢‰æÜÈñãÁôºÂ∑•ÂÖ∑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", "ÂæÆËªüÈõÖÈªë", Arial, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }

        /* È†ÇÈÉ®Â∞éËà™ */
        .top-nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav-title {
            font-size: 24px;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .nav-link:hover {
            background-color: rgba(255,255,255,0.2);
        }

        /* ‰∏ªË¶ÅÂÖßÂÆπ */
        .main-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        /* Ë≠¶ÂëäÊèêÁ§∫ */
        .warning-banner {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .warning-icon {
            font-size: 24px;
            color: #e17055;
        }

        .warning-text {
            color: #856404;
        }

        /* ÁãÄÊÖãÂç°Áâá */
        .status-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 5px solid #4CAF50;
        }

        .status-card.error {
            border-left-color: #f44336;
        }

        .status-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .status-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .status-value.error {
            color: #f44336;
        }

        .status-description {
            font-size: 14px;
            color: #666;
        }

        /* Â∑•ÂÖ∑Èù¢Êùø */
        .tool-panel {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .panel-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }

        /* ÊåâÈàïÁµÑ */
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .tool-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-btn.primary {
            background-color: #4CAF50;
            color: white;
        }

        .tool-btn.primary:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        .tool-btn.secondary {
            background-color: #2196F3;
            color: white;
        }

        .tool-btn.secondary:hover {
            background-color: #1976D2;
            transform: translateY(-2px);
        }

        .tool-btn.warning {
            background-color: #ff9800;
            color: white;
        }

        .tool-btn.warning:hover {
            background-color: #f57c00;
            transform: translateY(-2px);
        }

        .tool-btn.danger {
            background-color: #f44336;
            color: white;
        }

        .tool-btn.danger:hover {
            background-color: #d32f2f;
            transform: translateY(-2px);
        }

        .tool-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Ë≥áÊñôË°®Ê†º */
        .data-table-container {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-height: 500px;
            overflow-y: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .data-table th {
            background-color: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid #e9ecef;
            position: sticky;
            top: 0;
        }

        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }

        .data-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .data-cell-email {
            color: #4CAF50;
            font-weight: bold;
        }

        .data-cell-date {
            color: #666;
            font-size: 12px;
        }

        .data-cell-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            white-space: nowrap;
        }

        .status-active {
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        .status-processing {
            background-color: #fff3e0;
            color: #f57c00;
        }

        .status-completed {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        /* Êó•Ë™åÂçÄÂüü */
        .log-container {
            background-color: #1e1e1e;
            color: #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-title {
            color: #4CAF50;
            font-weight: bold;
            margin-bottom: 15px;
            font-family: inherit;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-timestamp {
            color: #888;
            font-size: 12px;
        }

        .log-level-info {
            color: #2196F3;
        }

        .log-level-success {
            color: #4CAF50;
        }

        .log-level-warning {
            color: #ff9800;
        }

        .log-level-error {
            color: #f44336;
        }

        /* ËºâÂÖ•ÊåáÁ§∫Âô® */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-content {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 15px;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-container {
                padding: 0 10px;
            }

            .status-container {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .tool-btn {
                justify-content: center;
            }

            .data-table-container {
                padding: 15px;
            }

            .data-table {
                font-size: 12px;
            }

            .data-table th,
            .data-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- È†ÇÈÉ®Â∞éËà™ -->
    <div class="top-nav">
        <div class="nav-container">
            <div class="nav-title">üõ†Ô∏è Êõ∏ÂÆ¢‰æÜË≥áÊñôÂ∫´ÁÆ°ÁêÜÂ∑•ÂÖ∑</div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">üìö ÂõûÂà∞Êõ∏Â∫ó</a>
                <a href="login.html" class="nav-link">üîë ÁôªÂÖ•È†ÅÈù¢</a>
                <a href="register.html" class="nav-link">üìù Ë®ªÂÜäÈ†ÅÈù¢</a>
                <a href="shopping.html" class="nav-link">üõí Ë≥ºÁâ©Ëªä</a>
            </div>
        </div>
    </div>

    <!-- ‰∏ªË¶ÅÂÖßÂÆπ -->
    <div class="main-container">
        <!-- Ë≠¶ÂëäÊèêÁ§∫ -->
        <div class="warning-banner">
            <div class="warning-icon">‚ö†Ô∏è</div>
            <div class="warning-text">
                <strong>ÈñãÁôºÂ∑•ÂÖ∑Ë≠¶ÂëäÔºö</strong>Ê≠§È†ÅÈù¢ÂÉÖ‰æõÈñãÁôºÂíåÊ∏¨Ë©¶‰ΩøÁî®„ÄÇÂú®ÁîüÁî¢Áí∞Â¢É‰∏≠ÔºåË´ãÂãøÊö¥Èú≤Ê≠§ÁÆ°ÁêÜÂ∑•ÂÖ∑Áµ¶‰∏ÄËà¨Áî®Êà∂„ÄÇ
                ÊâÄÊúâË≥áÊñôÂ∫´Êìç‰ΩúÈÉΩÊúÉÂΩ±ÈüøÁ≥ªÁµ±ÁãÄÊÖãÔºåË´ãË¨πÊÖé‰ΩøÁî®„ÄÇ
            </div>
        </div>

        <!-- Ë≥áÊñôÂ∫´ÁãÄÊÖã -->
        <div class="status-container">
            <div class="status-card" id="dbStatusCard">
                <div class="status-title">üìä Ë≥áÊñôÂ∫´ÁãÄÊÖã</div>
                <div class="status-value" id="dbStatusValue">ËºâÂÖ•‰∏≠...</div>
                <div class="status-description" id="dbStatusDesc">Ê≠£Âú®Ê™¢Êü•Ë≥áÊñôÂ∫´ÈÄ£Á∑ö</div>
            </div>
            <div class="status-card">
                <div class="status-title">üë• Áî®Êà∂Á∏ΩÊï∏</div>
                <div class="status-value" id="userCountValue">0</div>
                <div class="status-description">Â∑≤Ë®ªÂÜäÁöÑÊúÉÂì°Êï∏Èáè</div>
            </div>
            <div class="status-card">
                <div class="status-title">üì¶ Ë®ÇÂñÆÁ∏ΩÊï∏</div>
                <div class="status-value" id="orderCountValue">0</div>
                <div class="status-description">Á≥ªÁµ±‰∏≠ÁöÑË®ÇÂñÆÊï∏Èáè</div>
            </div>
            <div class="status-card">
                <div class="status-title">üí∞ Á∏ΩÈä∑ÂîÆÈ°ç</div>
                <div class="status-value" id="totalSalesValue">$0</div>
                <div class="status-description">Á¥ØË®àÈä∑ÂîÆÈáëÈ°ç</div>
            </div>
        </div>

        <!-- Ë≥áÊñôÂ∫´Êìç‰ΩúÂ∑•ÂÖ∑ -->
        <div class="tool-panel">
            <div class="panel-title">üîß Ë≥áÊñôÂ∫´Êìç‰Ωú</div>
            <div class="button-group">
                <button class="tool-btn primary" onclick="refreshStatus()">
                    üîÑ ÈáçÊñ∞Êï¥ÁêÜÁãÄÊÖã
                </button>
                <button class="tool-btn secondary" onclick="initTestData()">
                    üß™ ÂàùÂßãÂåñÊ∏¨Ë©¶Ë≥áÊñô
                </button>
                <button class="tool-btn warning" onclick="exportData()">
                    üì§ ÂåØÂá∫Ë≥áÊñô
                </button>
                <button class="tool-btn warning" onclick="importData()">
                    üì• ÂåØÂÖ•Ë≥áÊñô
                </button>
                <button class="tool-btn danger" onclick="clearDatabase()">
                    üóëÔ∏è Ê∏ÖÁ©∫Ë≥áÊñôÂ∫´
                </button>
            </div>
        </div>

        <!-- Áî®Êà∂ÁÆ°ÁêÜ -->
        <div class="tool-panel">
            <div class="panel-title">üë• Áî®Êà∂ÁÆ°ÁêÜ</div>
            <div class="button-group">
                <button class="tool-btn primary" onclick="loadUsers()">
                    üìã ËºâÂÖ•Áî®Êà∂ÂàóË°®
                </button>
                <button class="tool-btn secondary" onclick="createTestUser()">
                    ‚ûï ÂâµÂª∫Ê∏¨Ë©¶Áî®Êà∂
                </button>
            </div>
            <div class="data-table-container" id="usersTableContainer" style="display: none;">
                <table class="data-table" id="usersTable">
                    <thead>
                        <tr>
                            <th>Áî®Êà∂ID</th>
                            <th>ÈõªÂ≠êÈÉµ‰ª∂</th>
                            <th>ÂßìÂêç</th>
                            <th>Ë®ªÂÜäÊôÇÈñì</th>
                            <th>ÁãÄÊÖã</th>
                            <th>ÊúÄÂæåÁôªÂÖ•</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Ë®ÇÂñÆÁÆ°ÁêÜ -->
        <div class="tool-panel">
            <div class="panel-title">üì¶ Ë®ÇÂñÆÁÆ°ÁêÜ</div>
            <div class="button-group">
                <button class="tool-btn primary" onclick="loadOrders()">
                    üìã ËºâÂÖ•Ë®ÇÂñÆÂàóË°®
                </button>
                <button class="tool-btn secondary" onclick="createTestOrder()">
                    ‚ûï ÂâµÂª∫Ê∏¨Ë©¶Ë®ÇÂñÆ
                </button>
            </div>
            <div class="data-table-container" id="ordersTableContainer" style="display: none;">
                <table class="data-table" id="ordersTable">
                    <thead>
                        <tr>
                            <th>Ë®ÇÂñÆÁ∑®Ëôü</th>
                            <th>Áî®Êà∂ÈÉµ‰ª∂</th>
                            <th>Ë®ÇÂñÆÈáëÈ°ç</th>
                            <th>‰ªòÊ¨æÊñπÂºè</th>
                            <th>Ë®ÇÂñÆÁãÄÊÖã</th>
                            <th>Ë®ÇË≥ºÊôÇÈñì</th>
                            <th>ÂïÜÂìÅÊï∏Èáè</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Êìç‰ΩúÊó•Ë™å -->
        <div class="log-container">
            <div class="log-title">üìù Êìç‰ΩúÊó•Ë™å</div>
            <div id="logContent">
                <div class="log-entry">
                    <span class="log-timestamp">[ÂïüÂãï]</span>
                    <span class="log-level-info">Ë≥áÊñôÂ∫´ÁÆ°ÁêÜÂ∑•ÂÖ∑Â∑≤ËºâÂÖ•</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ËºâÂÖ•ÊåáÁ§∫Âô® -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Ê≠£Âú®ËôïÁêÜË´ãÊ±Ç...</p>
        </div>
    </div>

    <!-- Ë≥áÊñôÂ∫´ÁÆ°ÁêÜÁ≥ªÁµ± -->
    <script src="js/database.js"></script>
    <script>
        // Ë≥áÊñôÂ∫´ÁÆ°ÁêÜÂ∑•ÂÖ∑È°û
        class DatabaseAdminTool {
            constructor() {
                this.isReady = false;
                this.init();
            }

            async init() {
                console.log('üõ†Ô∏è ÂàùÂßãÂåñË≥áÊñôÂ∫´ÁÆ°ÁêÜÂ∑•ÂÖ∑');
                
                // Á≠âÂæÖË≥áÊñôÂ∫´Ê∫ñÂÇôÂ∞±Á∑í
                if (window.bookstoreDB && window.bookstoreDB.db) {
                    this.isReady = true;
                    await this.refreshStatus();
                } else {
                    // Áõ£ËÅΩË≥áÊñôÂ∫´Â∞±Á∑í‰∫ã‰ª∂
                    window.addEventListener('databaseReady', async () => {
                        this.isReady = true;
                        await this.refreshStatus();
                    });
                }
                
                this.addLog('info', 'ÁÆ°ÁêÜÂ∑•ÂÖ∑ÂàùÂßãÂåñÂÆåÊàê');
            }

            // ÈáçÊñ∞Êï¥ÁêÜÁãÄÊÖã
            async refreshStatus() {
                if (!this.isReady) {
                    this.addLog('error', 'Ë≥áÊñôÂ∫´Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑í');
                    this.updateDbStatus('error', 'Êú™ÈÄ£Á∑ö', 'Ë≥áÊñôÂ∫´Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑í');
                    return;
                }

                try {
                    this.addLog('info', 'Ê≠£Âú®Ê™¢Êü•Ë≥áÊñôÂ∫´ÁãÄÊÖã...');
                    
                    const status = await window.bookstoreDB.checkDatabaseStatus();
                    
                    if (status.isConnected) {
                        this.updateDbStatus('success', 'Â∑≤ÈÄ£Á∑ö', 'Ë≥áÊñôÂ∫´ÈÅã‰ΩúÊ≠£Â∏∏');
                        
                        // Êõ¥Êñ∞Áµ±Ë®àË≥áÊñô
                        document.getElementById('userCountValue').textContent = status.userCount;
                        document.getElementById('orderCountValue').textContent = status.orderCount;
                        
                        // Ë®àÁÆóÁ∏ΩÈä∑ÂîÆÈ°ç
                        const orders = await window.bookstoreDB.getAllOrders();
                        const totalSales = orders.reduce((sum, order) => sum + order.totalAmount, 0);
                        document.getElementById('totalSalesValue').textContent = `$${totalSales.toLocaleString()}`;
                        
                        this.addLog('success', `ÁãÄÊÖãÊõ¥Êñ∞ÂÆåÊàê - Áî®Êà∂: ${status.userCount}, Ë®ÇÂñÆ: ${status.orderCount}, Èä∑ÂîÆÈ°ç: $${totalSales.toLocaleString()}`);
                    } else {
                        this.updateDbStatus('error', 'ÈÄ£Á∑öÂ§±Êïó', status.error || 'Êú™Áü•ÈåØË™§');
                        this.addLog('error', 'Ë≥áÊñôÂ∫´ÈÄ£Á∑öÂ§±Êïó: ' + (status.error || 'Êú™Áü•ÈåØË™§'));
                    }
                } catch (error) {
                    console.error('‚ùå Ê™¢Êü•Ë≥áÊñôÂ∫´ÁãÄÊÖãÂ§±Êïó:', error);
                    this.updateDbStatus('error', 'Ê™¢Êü•Â§±Êïó', error.message);
                    this.addLog('error', 'Ê™¢Êü•Ë≥áÊñôÂ∫´ÁãÄÊÖãÂ§±Êïó: ' + error.message);
                }
            }

            // Êõ¥Êñ∞Ë≥áÊñôÂ∫´ÁãÄÊÖãÈ°ØÁ§∫
            updateDbStatus(type, status, description) {
                const card = document.getElementById('dbStatusCard');
                const valueElement = document.getElementById('dbStatusValue');
                const descElement = document.getElementById('dbStatusDesc');
                
                if (type === 'error') {
                    card.classList.add('error');
                    valueElement.classList.add('error');
                } else {
                    card.classList.remove('error');
                    valueElement.classList.remove('error');
                }
                
                valueElement.textContent = status;
                descElement.textContent = description;
            }

            // ÂàùÂßãÂåñÊ∏¨Ë©¶Ë≥áÊñô
            async initTestData() {
                if (!this.isReady) {
                    alert('Ë≥áÊñôÂ∫´Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑í');
                    return;
                }

                if (!confirm('Á¢∫ÂÆöË¶ÅÂàùÂßãÂåñÊ∏¨Ë©¶Ë≥áÊñôÂóéÔºüÈÄôÂ∞áÂâµÂª∫È†êË®≠ÁöÑÊ∏¨Ë©¶Áî®Êà∂ÂíåË®ÇÂñÆ„ÄÇ')) {
                    return;
                }

                this.showLoading(true);
                this.addLog('info', 'ÈñãÂßãÂàùÂßãÂåñÊ∏¨Ë©¶Ë≥áÊñô...');

                try {
                    await window.bookstoreDB.initTestData();
                    this.addLog('success', 'Ê∏¨Ë©¶Ë≥áÊñôÂàùÂßãÂåñÂÆåÊàê');
                    await this.refreshStatus();
                    alert('‚úÖ Ê∏¨Ë©¶Ë≥áÊñôÂàùÂßãÂåñÊàêÂäüÔºÅ');
                } catch (error) {
                    console.error('‚ùå ÂàùÂßãÂåñÊ∏¨Ë©¶Ë≥áÊñôÂ§±Êïó:', error);
                    this.addLog('error', 'ÂàùÂßãÂåñÊ∏¨Ë©¶Ë≥áÊñôÂ§±Êïó: ' + error.message);
                    alert('‚ùå ÂàùÂßãÂåñÂ§±Êïó: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // Ê∏ÖÁ©∫Ë≥áÊñôÂ∫´
            async clearDatabase() {
                if (!this.isReady) {
                    alert('Ë≥áÊñôÂ∫´Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑í');
                    return;
                }

                const confirmText = 'Ê∏ÖÁ©∫Ë≥áÊñôÂ∫´';
                const userInput = prompt(`‚ö†Ô∏è Âç±Èö™Êìç‰ΩúË≠¶ÂëäÔºÅ\n\nÈÄôÂ∞áÊ∏ÖÁ©∫ÊâÄÊúâÁî®Êà∂„ÄÅË®ÇÂñÆÂíåË≥ºÁâ©ËªäË≥áÊñôÔºåÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ\n\nË´ãËº∏ÂÖ• "${confirmText}" ‰æÜÁ¢∫Ë™çÊìç‰Ωú:`);
                
                if (userInput !== confirmText) {
                    this.addLog('info', 'Ê∏ÖÁ©∫Ë≥áÊñôÂ∫´Êìç‰ΩúÂ∑≤ÂèñÊ∂à');
                    return;
                }

                this.showLoading(true);
                this.addLog('warning', 'ÈñãÂßãÊ∏ÖÁ©∫Ë≥áÊñôÂ∫´...');

                try {
                    await window.bookstoreDB.resetAllData();
                    this.addLog('success', 'Ë≥áÊñôÂ∫´Â∑≤Ê∏ÖÁ©∫‰∏¶ÈáçÊñ∞ÂàùÂßãÂåñÊ∏¨Ë©¶Ë≥áÊñô');
                    await this.refreshStatus();
                    
                    // Ê∏ÖÁ©∫Ë°®Ê†ºÈ°ØÁ§∫
                    document.getElementById('usersTableContainer').style.display = 'none';
                    document.getElementById('ordersTableContainer').style.display = 'none';
                    
                    alert('‚úÖ Ë≥áÊñôÂ∫´Â∑≤Ê∏ÖÁ©∫‰∏¶ÈáçÊñ∞ÂàùÂßãÂåñÔºÅ');
                } catch (error) {
                    console.error('‚ùå Ê∏ÖÁ©∫Ë≥áÊñôÂ∫´Â§±Êïó:', error);
                    this.addLog('error', 'Ê∏ÖÁ©∫Ë≥áÊñôÂ∫´Â§±Êïó: ' + error.message);
                    alert('‚ùå Ê∏ÖÁ©∫Â§±Êïó: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // ËºâÂÖ•Áî®Êà∂ÂàóË°®
            async loadUsers() {
                if (!this.isReady) {
                    alert('Ë≥áÊñôÂ∫´Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑í');
                    return;
                }

                this.showLoading(true);
                this.addLog('info', 'Ê≠£Âú®ËºâÂÖ•Áî®Êà∂ÂàóË°®...');

                try {
                    const users = await window.bookstoreDB.getAllUsers();
                    this.displayUsers(users);
                    this.addLog('success', `Áî®Êà∂ÂàóË°®ËºâÂÖ•ÂÆåÊàêÔºåÂÖ± ${users.length} ‰ΩçÁî®Êà∂`);
                } catch (error) {
                    console.error('‚ùå ËºâÂÖ•Áî®Êà∂ÂàóË°®Â§±Êïó:', error);
                    this.addLog('error', 'ËºâÂÖ•Áî®Êà∂ÂàóË°®Â§±Êïó: ' + error.message);
                    alert('‚ùå ËºâÂÖ•Â§±Êïó: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // È°ØÁ§∫Áî®Êà∂ÂàóË°®
            displayUsers(users) {
                const tbody = document.getElementById('usersTableBody');
                const container = document.getElementById('usersTableContainer');
                
                tbody.innerHTML = '';
                
                if (users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #666;">Ê≤íÊúâÁî®Êà∂Ë≥áÊñô</td></tr>';
                } else {
                    users.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${user.userId}</td>
                            <td class="data-cell-email">${user.email}</td>
                            <td>${user.name}</td>
                            <td class="data-cell-date">${new Date(user.registrationDate).toLocaleString('zh-TW')}</td>
                            <td><span class="data-cell-status status-active">${user.isActive ? 'Ê¥ªË∫ç' : 'ÂÅúÁî®'}</span></td>
                            <td class="data-cell-date">${user.lastLoginDate ? new Date(user.lastLoginDate).toLocaleString('zh-TW') : 'ÂæûÊú™ÁôªÂÖ•'}</td>
                        `;
                        tbody.appendChild(row);
                    });
                }
                
                container.style.display = 'block';
            }

            // ËºâÂÖ•Ë®ÇÂñÆÂàóË°®
            async loadOrders() {
                if (!this.isReady) {
                    alert('Ë≥áÊñôÂ∫´Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑í');
                    return;
                }

                this.showLoading(true);
                this.addLog('info', 'Ê≠£Âú®ËºâÂÖ•Ë®ÇÂñÆÂàóË°®...');

                try {
                    const orders = await window.bookstoreDB.getAllOrders();
                    this.displayOrders(orders);
                    this.addLog('success', `Ë®ÇÂñÆÂàóË°®ËºâÂÖ•ÂÆåÊàêÔºåÂÖ± ${orders.length} Á≠ÜË®ÇÂñÆ`);
                } catch (error) {
                    console.error('‚ùå ËºâÂÖ•Ë®ÇÂñÆÂàóË°®Â§±Êïó:', error);
                    this.addLog('error', 'ËºâÂÖ•Ë®ÇÂñÆÂàóË°®Â§±Êïó: ' + error.message);
                    alert('‚ùå ËºâÂÖ•Â§±Êïó: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // È°ØÁ§∫Ë®ÇÂñÆÂàóË°®
            displayOrders(orders) {
                const tbody = document.getElementById('ordersTableBody');
                const container = document.getElementById('ordersTableContainer');
                
                tbody.innerHTML = '';
                
                if (orders.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #666;">Ê≤íÊúâË®ÇÂñÆË≥áÊñô</td></tr>';
                } else {
                    orders.forEach(order => {
                        const statusClass = {
                            'processing': 'status-processing',
                            'completed': 'status-completed',
                            'shipped': 'status-completed'
                        }[order.status] || 'status-processing';

                        const paymentMethodMap = {
                            'credit_card': '‰ø°Áî®Âç°',
                            'atm': 'ATMËΩâÂ∏≥',
                            'convenience_store': 'Ë∂ÖÂïÜÂèñË≤®‰ªòÊ¨æ',
                            'line_pay': 'LINE Pay'
                        };

                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="data-cell-email">${order.orderNumber}</td>
                            <td>${order.userEmail}</td>
                            <td>$${order.totalAmount.toLocaleString()}</td>
                            <td>${paymentMethodMap[order.paymentMethod] || order.paymentMethod}</td>
                            <td><span class="data-cell-status ${statusClass}">${order.statusText}</span></td>
                            <td class="data-cell-date">${new Date(order.orderDate).toLocaleString('zh-TW')}</td>
                            <td>${order.items.length} È†ÖÂïÜÂìÅ</td>
                        `;
                        tbody.appendChild(row);
                    });
                }
                
                container.style.display = 'block';
            }

            // ÂâµÂª∫Ê∏¨Ë©¶Áî®Êà∂
            async createTestUser() {
                if (!this.isReady) {
                    alert('Ë≥áÊñôÂ∫´Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑í');
                    return;
                }

                const email = prompt('Ë´ãËº∏ÂÖ•Ê∏¨Ë©¶Áî®Êà∂ÁöÑÈõªÂ≠êÈÉµ‰ª∂:');
                if (!email) return;

                const name = prompt('Ë´ãËº∏ÂÖ•Ê∏¨Ë©¶Áî®Êà∂ÁöÑÂßìÂêç:') || 'Ê∏¨Ë©¶Áî®Êà∂';

                this.showLoading(true);
                this.addLog('info', `Ê≠£Âú®ÂâµÂª∫Ê∏¨Ë©¶Áî®Êà∂: ${email}`);

                try {
                    const userData = {
                        email: email.toLowerCase().trim(),
                        password: '123456',
                        name: name,
                        phone: '0912345678',
                        address: 'Ê∏¨Ë©¶Âú∞ÂùÄ'
                    };

                    await window.bookstoreDB.registerUser(userData);
                    this.addLog('success', `Ê∏¨Ë©¶Áî®Êà∂ÂâµÂª∫ÊàêÂäü: ${email}`);
                    await this.refreshStatus();
                    alert('‚úÖ Ê∏¨Ë©¶Áî®Êà∂ÂâµÂª∫ÊàêÂäüÔºÅ\n\nÁôªÂÖ•Ë≥áË®ä:\nÈõªÂ≠êÈÉµ‰ª∂: ' + email + '\nÂØÜÁ¢º: 123456');
                } catch (error) {
                    console.error('‚ùå ÂâµÂª∫Ê∏¨Ë©¶Áî®Êà∂Â§±Êïó:', error);
                    this.addLog('error', 'ÂâµÂª∫Ê∏¨Ë©¶Áî®Êà∂Â§±Êïó: ' + error.message);
                    alert('‚ùå ÂâµÂª∫Â§±Êïó: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // ÂâµÂª∫Ê∏¨Ë©¶Ë®ÇÂñÆ
            async createTestOrder() {
                if (!this.isReady) {
                    alert('Ë≥áÊñôÂ∫´Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑í');
                    return;
                }

                const userEmail = prompt('Ë´ãËº∏ÂÖ•Áî®Êà∂ÈõªÂ≠êÈÉµ‰ª∂ (ÁïôÁ©∫‰ΩøÁî® test@bookstore.com):') || 'test@bookstore.com';

                this.showLoading(true);
                this.addLog('info', `Ê≠£Âú®ÁÇ∫Áî®Êà∂ ${userEmail} ÂâµÂª∫Ê∏¨Ë©¶Ë®ÇÂñÆ`);

                try {
                    const orderData = {
                        userEmail: userEmail.toLowerCase().trim(),
                        items: [
                            {
                                id: 'test_book_' + Date.now(),
                                title: 'Ê∏¨Ë©¶Êõ∏Á±ç - ' + new Date().toLocaleString(),
                                price: 299,
                                quantity: 1
                            }
                        ],
                        totalAmount: 299,
                        paymentMethod: 'credit_card',
                        shippingAddress: 'Ê∏¨Ë©¶Âú∞ÂùÄ',
                        notes: 'Ê∏¨Ë©¶Ë®ÇÂñÆ - Áî±ÁÆ°ÁêÜÂ∑•ÂÖ∑ÂâµÂª∫'
                    };

                    const newOrder = await window.bookstoreDB.createOrder(orderData);
                    this.addLog('success', `Ê∏¨Ë©¶Ë®ÇÂñÆÂâµÂª∫ÊàêÂäü: ${newOrder.orderNumber}`);
                    await this.refreshStatus();
                    alert('‚úÖ Ê∏¨Ë©¶Ë®ÇÂñÆÂâµÂª∫ÊàêÂäüÔºÅ\n\nË®ÇÂñÆÁ∑®Ëôü: ' + newOrder.orderNumber);
                } catch (error) {
                    console.error('‚ùå ÂâµÂª∫Ê∏¨Ë©¶Ë®ÇÂñÆÂ§±Êïó:', error);
                    this.addLog('error', 'ÂâµÂª∫Ê∏¨Ë©¶Ë®ÇÂñÆÂ§±Êïó: ' + error.message);
                    alert('‚ùå ÂâµÂª∫Â§±Êïó: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // ÂåØÂá∫Ë≥áÊñô
            async exportData() {
                if (!this.isReady) {
                    alert('Ë≥áÊñôÂ∫´Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑í');
                    return;
                }

                this.showLoading(true);
                this.addLog('info', 'Ê≠£Âú®ÂåØÂá∫Ë≥áÊñô...');

                try {
                    const users = await window.bookstoreDB.getAllUsers();
                    const orders = await window.bookstoreDB.getAllOrders();
                    
                    const exportData = {
                        exportDate: new Date().toISOString(),
                        version: '1.0',
                        users: users,
                        orders: orders
                    };
                    
                    const dataStr = JSON.stringify(exportData, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `bookstore_data_export_${new Date().toISOString().split('T')[0]}.json`;
                    link.click();
                    
                    this.addLog('success', `Ë≥áÊñôÂåØÂá∫ÂÆåÊàê - Áî®Êà∂: ${users.length}, Ë®ÇÂñÆ: ${orders.length}`);
                    alert('‚úÖ Ë≥áÊñôÂåØÂá∫ÂÆåÊàêÔºÅÊ™îÊ°àÂ∑≤‰∏ãËºâ„ÄÇ');
                } catch (error) {
                    console.error('‚ùå ÂåØÂá∫Ë≥áÊñôÂ§±Êïó:', error);
                    this.addLog('error', 'ÂåØÂá∫Ë≥áÊñôÂ§±Êïó: ' + error.message);
                    alert('‚ùå ÂåØÂá∫Â§±Êïó: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            // ÂåØÂÖ•Ë≥áÊñô
            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    this.showLoading(true);
                    this.addLog('info', 'Ê≠£Âú®ÂåØÂÖ•Ë≥áÊñô...');
                    
                    try {
                        const text = await file.text();
                        const data = JSON.parse(text);
                        
                        if (!data.users || !data.orders) {
                            throw new Error('ÁÑ°ÊïàÁöÑË≥áÊñôÊ†ºÂºè');
                        }
                        
                        // ÈÄôË£°ÊáâË©≤ÂØ¶‰ΩúÂåØÂÖ•ÈÇèËºØ
                        // ÁÇ∫‰∫ÜÁ∞°ÂåñÔºåÊö´ÊôÇÂè™È°ØÁ§∫Ë≥áÊñôÁµ±Ë®à
                        this.addLog('info', `Ê∫ñÂÇôÂåØÂÖ• - Áî®Êà∂: ${data.users.length}, Ë®ÇÂñÆ: ${data.orders.length}`);
                        alert(`üìä Ë≥áÊñôÈ†êË¶Ω:\n\nÁî®Êà∂Êï∏Èáè: ${data.users.length}\nË®ÇÂñÆÊï∏Èáè: ${data.orders.length}\nÂåØÂá∫Êó•Êúü: ${data.exportDate}\n\n‚ö†Ô∏è ÂåØÂÖ•ÂäüËÉΩÂ∞öÊú™ÂÆåÂÖ®ÂØ¶‰ΩúÔºåË´ãÊâãÂãïËôïÁêÜË≥áÊñô„ÄÇ`);
                        
                        this.addLog('warning', 'ÂåØÂÖ•ÂäüËÉΩÂ∞öÊú™ÂÆåÂÖ®ÂØ¶‰Ωú');
                    } catch (error) {
                        console.error('‚ùå ÂåØÂÖ•Ë≥áÊñôÂ§±Êïó:', error);
                        this.addLog('error', 'ÂåØÂÖ•Ë≥áÊñôÂ§±Êïó: ' + error.message);
                        alert('‚ùå ÂåØÂÖ•Â§±Êïó: ' + error.message);
                    } finally {
                        this.showLoading(false);
                    }
                };
                input.click();
            }

            // È°ØÁ§∫/Èö±ËóèËºâÂÖ•ÊåáÁ§∫Âô®
            showLoading(show) {
                const overlay = document.getElementById('loadingOverlay');
                overlay.style.display = show ? 'flex' : 'none';
            }

            // Ê∑ªÂä†Êó•Ë™å
            addLog(level, message) {
                const logContent = document.getElementById('logContent');
                const timestamp = new Date().toLocaleString('zh-TW');
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `
                    <span class="log-timestamp">[${timestamp}]</span>
                    <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                    <span>${message}</span>
                `;
                
                logContent.appendChild(logEntry);
                
                // ‰øùÊåÅÊó•Ë™åÂú®Â∫ïÈÉ®
                logContent.scrollTop = logContent.scrollHeight;
                
                // ÈôêÂà∂Êó•Ë™åÊï∏Èáè
                const entries = logContent.querySelectorAll('.log-entry');
                if (entries.length > 100) {
                    entries[0].remove();
                }
            }
        }

        // ÂâµÂª∫ÂÖ®ÂüüÁÆ°ÁêÜÂ∑•ÂÖ∑ÂØ¶‰æã
        let adminTool;

        // ÂÖ®ÂüüÂáΩÊï∏
        function refreshStatus() {
            if (adminTool) adminTool.refreshStatus();
        }

        function initTestData() {
            if (adminTool) adminTool.initTestData();
        }

        function clearDatabase() {
            if (adminTool) adminTool.clearDatabase();
        }

        function loadUsers() {
            if (adminTool) adminTool.loadUsers();
        }

        function loadOrders() {
            if (adminTool) adminTool.loadOrders();
        }

        function createTestUser() {
            if (adminTool) adminTool.createTestUser();
        }

        function createTestOrder() {
            if (adminTool) adminTool.createTestOrder();
        }

        function exportData() {
            if (adminTool) adminTool.exportData();
        }

        function importData() {
            if (adminTool) adminTool.importData();
        }

        // È†ÅÈù¢ËºâÂÖ•ÊôÇÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üõ†Ô∏è Ë≥áÊñôÂ∫´ÁÆ°ÁêÜÂ∑•ÂÖ∑ËºâÂÖ•ÂÆåÊàê');
            
            // Á≠âÂæÖË≥áÊñôÂ∫´Ê∫ñÂÇôÂ∞±Á∑íÂæåÂàùÂßãÂåñ
            const initAdminTool = () => {
                if (window.bookstoreDB) {
                    adminTool = new DatabaseAdminTool();
                } else {
                    setTimeout(initAdminTool, 100);
                }
            };
            
            initAdminTool();
        });

        // Áõ£ËÅΩË≥áÊñôÂ∫´‰∫ã‰ª∂
        window.addEventListener('databaseReady', function(e) {
            console.log('üìä Ë≥áÊñôÂ∫´Â∑≤Â∞±Á∑íÔºåÁÆ°ÁêÜÂ∑•ÂÖ∑ÂèØÊ≠£Â∏∏‰ΩøÁî®');
        });

        window.addEventListener('databaseError', function(e) {
            console.warn('‚ö†Ô∏è Ë≥áÊñôÂ∫´ÁôºÁîüÈåØË™§ÔºåÊüê‰∫õÂäüËÉΩÂèØËÉΩÁÑ°Ê≥ïÊ≠£Â∏∏‰ΩøÁî®');
        });

        console.log('üõ†Ô∏è Ë≥áÊñôÂ∫´ÁÆ°ÁêÜÂ∑•ÂÖ∑ËÖ≥Êú¨ËºâÂÖ•ÂÆåÊàê');
    </script>
</body>
</html>