<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">æœå°‹çµæœ - æ›¸å®¢ä¾†ç·šä¸Šæ›¸åº—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft YaHei", "å¾®è»Ÿé›…é»‘", Arial, sans-serif;
            background-color: #f5f5f5;
        }

        /* é ‚éƒ¨å°èˆª */
        .top-nav {
            background-color: #fff;
            border-bottom: 1px solid #e0e0e0;
            padding: 8px 0;
        }

        .top-nav .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            font-size: 13px;
        }

        .nav-left a, .nav-right a {
            color: #666;
            text-decoration: none;
            margin: 0 10px;
        }

        .nav-left a:hover, .nav-right a:hover {
            color: #4CAF50;
        }

        .cart-count {
            color: #ff6b35;
            font-weight: bold;
        }

        /* æœå°‹å€åŸŸ */
        .search-section {
            background-color: #fff;
            padding: 15px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .search-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            margin-right: 30px;
        }

        .logo h1 {
            color: #4CAF50;
            font-size: 24px;
            font-weight: bold;
            text-decoration: none;
        }

        .search-box {
            flex: 1;
            display: flex;
            max-width: 600px;
        }

        .category-select {
            background-color: #f8f8f8;
            border: 2px solid #4CAF50;
            border-right: none;
            padding: 12px 15px;
            font-size: 14px;
            border-radius: 25px 0 0 25px;
            outline: none;
        }

        .search-input {
            flex: 1;
            border: 2px solid #4CAF50;
            border-left: none;
            border-right: none;
            padding: 12px 15px;
            font-size: 14px;
            outline: none;
        }

        .search-btn {
            background-color: #4CAF50;
            color: white;
            border: 2px solid #4CAF50;
            padding: 12px 20px;
            font-size: 14px;
            border-radius: 0 25px 25px 0;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .search-btn:hover {
            background-color: #45a049;
        }

        /* åˆ†é¡å°èˆª */
        .category-nav {
            background-color: #4CAF50;
            padding: 10px 0;
        }

        .category-nav .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .category-links {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .category-links a {
            color: white;
            text-decoration: none;
            font-size: 14px;
            padding: 5px 0;
        }

        .category-links a:hover {
            text-decoration: underline;
        }

        /* éºµåŒ…å±‘å°èˆª */
        .breadcrumb {
            background-color: #fff;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .breadcrumb .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            font-size: 13px;
            color: #666;
        }

        .breadcrumb a {
            color: #4CAF50;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        /* é—œéµå­—æ¨™ç±¤ */
        .keyword-tags {
            background-color: #fff;
            padding: 15px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .keyword-tags .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .tags-row {
            margin-bottom: 10px;
        }

        .tag-label {
            font-size: 13px;
            color: #666;
            margin-right: 10px;
        }

        .tag {
            display: inline-block;
            background-color: #f0f0f0;
            color: #666;
            padding: 4px 8px;
            margin: 2px 4px;
            border-radius: 12px;
            font-size: 12px;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag:hover {
            background-color: #4CAF50;
            color: white;
        }

        .tag.active {
            background-color: #4CAF50;
            color: white;
        }

        /* ä¸»è¦å…§å®¹å€åŸŸ */
        .main-container {
            max-width: 1200px;
            margin: 20px auto;
            display: flex;
            gap: 20px;
            padding: 0 20px;
        }

        /* å·¦å´ç¯©é¸å™¨ */
        .sidebar {
            width: 200px;
            flex-shrink: 0;
        }

        .filter-section {
            background-color: #fff;
            border-radius: 4px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .filter-header {
            background-color: #f8f8f8;
            padding: 12px 15px;
            font-weight: bold;
            font-size: 14px;
            color: #333;
            border-bottom: 1px solid #e0e0e0;
        }

        .filter-content {
            padding: 10px 15px;
        }

        .filter-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
            cursor: pointer;
        }

        .filter-checkbox input {
            margin-right: 8px;
        }

        .filter-checkbox .count {
            color: #999;
            margin-left: auto;
        }

        /* æ’åºå·¥å…·æ¬„ */
        .toolbar {
            background-color: #fff;
            padding: 15px 20px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sort-options {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .sort-btn {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .sort-btn:hover {
            border-color: #4CAF50;
            color: #4CAF50;
        }

        .sort-btn.active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .view-options {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .view-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            background-color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
        }

        .view-btn.active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        /* å•†å“çµæœå€åŸŸ */
        .results-section {
            flex: 1;
        }

        .results-header {
            margin-bottom: 20px;
        }

        .results-info {
            font-size: 14px;
            color: #666;
        }

        .results-highlight {
            color: #e74c3c;
            font-weight: bold;
        }

        /* å•†å“ç¶²æ ¼ */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .product-card {
            background-color: #fff;
            border-radius: 4px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }

        .product-image {
            width: 100%;
            height: 240px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 12px;
            position: relative;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background-color: #e74c3c;
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: bold;
        }

        .product-info {
            padding: 15px;
        }

        .product-title {
            font-size: 13px;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.4;
            height: 35px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .product-author {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .current-price {
            color: #e74c3c;
            font-weight: bold;
            font-size: 14px;
        }

        .original-price {
            color: #999;
            font-size: 12px;
            text-decoration: line-through;
        }

        .discount-rate {
            background-color: #ff6b35;
            color: white;
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 10px;
        }

        /* æ“ä½œæŒ‰éˆ• */
        .product-actions {
            display: flex;
            justify-content: space-between;
            gap: 8px;
        }

        .action-btn {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #ddd;
            background-color: #fff;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            text-align: center;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .cart-btn {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .cart-btn:hover {
            background-color: #45a049;
        }

        /* åˆ†é  */
        .pagination {
            margin-top: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background-color: #fff;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.3s;
        }

        .page-btn:hover {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .page-btn.active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* è¼‰å…¥ä¸­ */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                padding: 0 10px;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .search-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .search-box {
                max-width: 100%;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .category-links {
                gap: 15px;
            }
            
            .toolbar {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- é ‚éƒ¨å°èˆª -->
    <div class="top-nav">
        <div class="container">
            <div class="nav-left">
                <a href="index.html">å›é¦–é </a>
                <a href="#" onclick="showNewReleases()">æ–°æ›¸æ¨è–¦</a>
                <a href="#" onclick="showBestsellers()">æš¢éŠ·æ¦œ</a>
                <a href="#" onclick="showEbooks()">é›»å­æ›¸åŸ</a>
            </div>
            <div class="nav-right">
                <span id="userInfo">æœªç™»å…¥</span>
                <a href="#" id="loginLogoutBtn" onclick="handleLoginLogout()">æœƒå“¡ç™»å…¥</a>
                <a href="#" onclick="showOrders()">è¨‚å–®æŸ¥è©¢</a>
                <a href="shopping.html">è³¼ç‰©è»Š(<span class="cart-count" id="cartCount">0</span>)</a>
                <a href="#" onclick="toggleLanguage()">ç¹é«”</a>
            </div>
        </div>
    </div>

    <!-- æœå°‹å€åŸŸ -->
    <div class="search-section">
        <div class="search-container">
            <div class="logo">
                <a href="index.html" style="text-decoration: none;">
                    <h1>æ›¸å®¢ä¾†</h1>
                </a>
            </div>
            <div class="search-box">
                <select class="category-select" id="searchCategory">
                    <option value="all">å…¨éƒ¨</option>
                    <option value="chinese">ä¸­æ–‡æ›¸</option>
                    <option value="english">å¤–æ–‡æ›¸</option>
                    <option value="ebook">é›»å­æ›¸</option>
                    <option value="magazine">é›œèªŒ</option>
                </select>
                <input type="text" class="search-input" placeholder="è«‹è¼¸å…¥é—œéµå­—" id="searchInput">
                <button class="search-btn" onclick="performSearch()">ğŸ”</button>
            </div>
        </div>
    </div>

    <!-- åˆ†é¡å°èˆª -->
    <div class="category-nav">
        <div class="container">
            <div class="category-links">
                <a href="#">å…¨ç«™åˆ†é¡</a>
                <a href="#">ä¸­æ–‡æ›¸ç±</a>
                <a href="#">å¤–æ–‡æ›¸ç±</a>
                <a href="#">é›»å­æ›¸</a>
                <a href="#">ç«¥æ›¸é¤¨</a>
                <a href="#">æ–‡å­¸å°èªª</a>
                <a href="#">å•†æ¥­ç†è²¡</a>
                <a href="#">å¿ƒç†å‹µå¿—</a>
            </div>
        </div>
    </div>

    <!-- éºµåŒ…å±‘å°èˆª -->
    <div class="breadcrumb">
        <div class="container">
            <a href="index.html">æ›¸å®¢ä¾†</a> > 
            <span id="breadcrumbPath">æœå°‹çµæœ</span>
        </div>
    </div>

    <!-- é—œéµå­—æ¨™ç±¤ -->
    <div class="keyword-tags">
        <div class="container">
            <div class="tags-row">
                <span class="tag-label">ç†±é–€æ›¸ç±ï¼š</span>
                <a href="#" class="tag" onclick="searchKeyword('å“ˆåˆ©æ³¢ç‰¹')">å“ˆåˆ©æ³¢ç‰¹</a>
                <a href="#" class="tag" onclick="searchKeyword('æ‘ä¸Šæ˜¥æ¨¹')">æ‘ä¸Šæ˜¥æ¨¹</a>
                <a href="#" class="tag" onclick="searchKeyword('æ±é‡åœ­å¾')">æ±é‡åœ­å¾</a>
                <a href="#" class="tag" onclick="searchKeyword('é‡‘åº¸')">é‡‘åº¸</a>
                <a href="#" class="tag" onclick="searchKeyword('ä¸‰é«”')">ä¸‰é«”</a>
                <a href="#" class="tag" onclick="searchKeyword('é¬¼æ»…ä¹‹åˆƒ')">é¬¼æ»…ä¹‹åˆƒ</a>
                <a href="#" class="tag" onclick="searchKeyword('åŸå­ç¿’æ…£')">åŸå­ç¿’æ…£</a>
                <a href="#" class="tag" onclick="searchKeyword('äººé¡å¤§æ­·å²')">äººé¡å¤§æ­·å²</a>
                <a href="#" class="tag" onclick="searchKeyword('å¿ƒç†å­¸')">å¿ƒç†å­¸</a>
                <a href="#" class="tag" onclick="searchKeyword('æŠ•è³‡ç†è²¡')">æŠ•è³‡ç†è²¡</a>
            </div>
            <div class="tags-row">
                <span class="tag-label">ç†±é–€åˆ†é¡ï¼š</span>
                <a href="#" class="tag" onclick="searchKeyword('æ–‡å­¸å°èªª')">æ–‡å­¸å°èªª</a>
                <a href="#" class="tag" onclick="searchKeyword('å•†æ¥­ç†è²¡')">å•†æ¥­ç†è²¡</a>
                <a href="#" class="tag" onclick="searchKeyword('å¿ƒç†å‹µå¿—')">å¿ƒç†å‹µå¿—</a>
                <a href="#" class="tag" onclick="searchKeyword('æ¼«ç•«')">æ¼«ç•«</a>
                <a href="#" class="tag" onclick="searchKeyword('ç«¥æ›¸')">ç«¥æ›¸</a>
                <a href="#" class="tag" onclick="searchKeyword('ç§‘æ™®')">ç§‘æ™®</a>
                <a href="#" class="tag" onclick="searchKeyword('æ­·å²')">æ­·å²</a>
                <a href="#" class="tag" onclick="searchKeyword('è—è¡“è¨­è¨ˆ')">è—è¡“è¨­è¨ˆ</a>
                <a href="#" class="tag" onclick="searchKeyword('èªè¨€å­¸ç¿’')">èªè¨€å­¸ç¿’</a>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹ -->
    <div class="main-container">
        <!-- å·¦å´ç¯©é¸å™¨ -->
        <div class="sidebar">
            <div class="filter-section">
                <div class="filter-header">åˆ†é¡ (è¤‡é¸)</div>
                <div class="filter-content">
                    <div class="filter-checkbox" onclick="toggleFilter('all', this)">
                        <input type="checkbox" checked>
                        <span>æ‰€æœ‰æ›¸ç±(<span id="allCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox" onclick="toggleFilter('chinese', this)">
                        <input type="checkbox">
                        <span>ä¸­æ–‡æ›¸(<span id="chineseCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox" onclick="toggleFilter('english', this)">
                        <input type="checkbox">
                        <span>å¤–æ–‡æ›¸(<span id="englishCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox" onclick="toggleFilter('ebook', this)">
                        <input type="checkbox">
                        <span>é›»å­æ›¸(<span id="ebookCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox" onclick="toggleFilter('audiobook', this)">
                        <input type="checkbox">
                        <span>æœ‰è²æ›¸(<span id="audiobookCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox" onclick="toggleFilter('magazine', this)">
                        <input type="checkbox">
                        <span>é›œèªŒæœŸåˆŠ(<span id="magazineCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox" onclick="toggleFilter('textbook', this)">
                        <input type="checkbox">
                        <span>æ•™ç§‘æ›¸(<span id="textbookCount">0</span>)</span>
                    </div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-header">æ–‡å­¸å°èªª(<span id="fictionCount">0</span>)</div>
                <div class="filter-content">
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>è¯æ–‡å‰µä½œ(<span id="chineseCreationCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>ç¿»è­¯æ–‡å­¸(<span id="translatedCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>ç§‘å¹»å¥‡å¹»(<span id="scifiCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>æ¨ç†æ‡¸ç–‘(<span id="mysteryCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>æ„›æƒ…æ–‡å­¸(<span id="romanceCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>æ­·å²å°èªª(<span id="historicalCount">0</span>)</span>
                    </div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-header">å•†æ¥­ç†è²¡(<span id="businessCount">0</span>)</div>
                <div class="filter-content">
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>æŠ•è³‡ç†è²¡(<span id="investmentCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>è·å ´å·¥ä½œè¡“(<span id="workplaceCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>è¡ŒéŠ·ä¼ç®¡(<span id="marketingCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>ç¶“æ¿Ÿå­¸(<span id="economicsCount">0</span>)</span>
                    </div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-header">å¿ƒç†å‹µå¿—(<span id="psychologyCount">0</span>)</div>
                <div class="filter-content">
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>å¿ƒç†å­¸(<span id="psychologyBookCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>å‹µå¿—æˆåŠŸ(<span id="motivationCount">0</span>)</span>
                    </div>
                    <div class="filter-checkbox">
                        <input type="checkbox">
                        <span>äººéš›é—œä¿‚(<span id="relationshipCount">0</span>)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- å•†å“çµæœå€åŸŸ -->
        <div class="results-section">
            <!-- å·¥å…·æ¬„ -->
            <div class="toolbar">
                <div class="sort-options">
                    <button class="sort-btn active" onclick="sortResults('relevance', this)">ç¶œåˆæ’åº</button>
                    <button class="sort-btn" onclick="sortResults('popularity', this)">ç†±éŠ·åº¦</button>
                    <button class="sort-btn" onclick="sortResults('date', this)">æ—¥æœŸ</button>
                    <button class="sort-btn" onclick="sortResults('price', this)">åƒ¹æ ¼</button>
                    <span style="margin-left: 20px;">
                        æœ€ä½åƒ¹ 
                        <input type="number" style="width: 60px; padding: 4px; border: 1px solid #ddd; border-radius: 3px;" id="minPrice" placeholder="0">
                        ~ æœ€é«˜åƒ¹
                        <input type="number" style="width: 60px; padding: 4px; border: 1px solid #ddd; border-radius: 3px;" id="maxPrice" placeholder="999">
                        <button onclick="applyPriceFilter()" style="margin-left: 8px; padding: 4px 8px; background-color: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer;">ç¢ºèª</button>
                    </span>
                </div>
                
                <div class="view-options">
                    <span style="font-size: 13px; margin-right: 10px;">é¡¯ç¤ºæ‰€æœ‰æ›¸ç±</span>
                    <button class="view-btn active" onclick="setView('grid', this)" title="ç¶²æ ¼æª¢è¦–">âŠ</button>
                    <button class="view-btn" onclick="setView('list', this)" title="åˆ—è¡¨æª¢è¦–">â˜°</button>
                    <button class="view-btn" onclick="setView('small', this)" title="å°åœ–æª¢è¦–">âŠ¡</button>
                </div>
            </div>

            <!-- æœå°‹çµæœè³‡è¨Š -->
            <div class="results-header">
                <div class="results-info">
                    æœå°‹çµæœå…± <span class="results-highlight" id="totalResults">0</span> ç­†ï¼Œé æ•¸ <span id="currentPage">1</span> / <span id="totalPages">1</span>
                    <span style="float: right;">æª¢è¦–ï¼š
                        <button class="sort-btn" onclick="toggleViewOption('list')">âŠ åˆ—è¡¨</button>
                        <button class="sort-btn" onclick="toggleViewOption('grid')">âŠ å°åœ–</button>
                    </span>
                </div>
            </div>

            <!-- è¼‰å…¥ä¸­ -->
            <div class="loading" id="loadingIndicator">
                <div class="loading-spinner"></div>
                <p>æ­£åœ¨æœå°‹æ›¸ç±è³‡æ–™...</p>
            </div>

            <!-- å•†å“ç¶²æ ¼ -->
            <div class="products-grid" id="productsGrid" style="display: none;">
                <!-- å•†å“å°‡é€šé JavaScript è¼‰å…¥ -->
            </div>

            <!-- åˆ†é  -->
            <div class="pagination" id="pagination" style="display: none;">
                <!-- åˆ†é æŒ‰éˆ•å°‡é€šé JavaScript ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script src="js/google-books.js"></script>
    <script>
        // æœå°‹ç‹€æ…‹ç®¡ç†
        let searchState = {
            query: '',
            category: 'all',
            currentPage: 1,
            pageSize: 18,
            sortBy: 'relevance',
            filters: {
                category: 'all',
                minPrice: null,
                maxPrice: null
            },
            results: [],
            totalResults: 0
        };

        // åˆå§‹åŒ–é é¢
        function initializePage() {
            checkLoginStatus();
            updateCartDisplay();
            
            // å¾ URL åƒæ•¸ç²å–æœå°‹æ¢ä»¶
            const urlParams = new URLSearchParams(window.location.search);
            const query = urlParams.get('q') || '';
            const category = urlParams.get('category') || 'all';
            
            if (query) {
                searchState.query = query;
                searchState.category = category;
                
                // æ›´æ–°æœå°‹æ¡†
                document.getElementById('searchInput').value = query;
                document.getElementById('searchCategory').value = category;
                
                // æ›´æ–°é é¢æ¨™é¡Œå’ŒéºµåŒ…å±‘
                document.getElementById('pageTitle').textContent = `"${query}" çš„æœå°‹çµæœ - æ›¸å®¢ä¾†ç·šä¸Šæ›¸åº—`;
                document.getElementById('breadcrumbPath').textContent = `æœå°‹çµæœï¼š"${query}"`;
                
                // åŸ·è¡Œæœå°‹
                performSearch();
            } else {
                // æ²’æœ‰æœå°‹æ¢ä»¶ï¼Œé¡¯ç¤ºæç¤º
                showNoSearchMessage();
            }
        }

        // åŸ·è¡Œæœå°‹
        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            const category = document.getElementById('searchCategory').value;
            
            if (!query) {
                alert('è«‹è¼¸å…¥æœå°‹é—œéµå­—');
                return;
            }
            
            searchState.query = query;
            searchState.category = category;
            searchState.currentPage = 1;
            
            // æ›´æ–° URL
            const newUrl = `${window.location.pathname}?q=${encodeURIComponent(query)}&category=${category}`;
            window.history.replaceState(null, '', newUrl);
            
            // æ›´æ–°é é¢æ¨™é¡Œå’ŒéºµåŒ…å±‘
            document.getElementById('pageTitle').textContent = `"${query}" çš„æœå°‹çµæœ - æ›¸å®¢ä¾†ç·šä¸Šæ›¸åº—`;
            document.getElementById('breadcrumbPath').textContent = `æœå°‹çµæœï¼š"${query}"`;
            
            await executeSearch();
        }

        // åŸ·è¡Œå¯¦éš›æœå°‹
        async function executeSearch() {
            showLoading(true);
            
            try {
                console.log(`æœå°‹: "${searchState.query}" (åˆ†é¡: ${searchState.category})`);
                
                // æ§‹å»ºæœå°‹æŸ¥è©¢
                let searchQuery = searchState.query;
                
                // æ ¹æ“šåˆ†é¡èª¿æ•´æœå°‹
                if (searchState.category !== 'all') {
                    const categoryMap = {
                        'chinese': 'ä¸­æ–‡',
                        'english': 'english',
                        'ebook': 'ebook',
                        'magazine': 'magazine'
                    };
                    
                    if (categoryMap[searchState.category]) {
                        searchQuery += ` ${categoryMap[searchState.category]}`;
                    }
                }
                
                // ä½¿ç”¨ Google Books API æœå°‹
                const results = await window.googleBooksAPI.searchBooks(searchQuery, 40);
                
                searchState.results = results;
                searchState.totalResults = results.length;
                
                // å¥—ç”¨ç¯©é¸å™¨
                const filteredResults = applyFilters(results);
                
                // å¥—ç”¨æ’åº
                const sortedResults = applySorting(filteredResults);
                
                // åˆ†é è™•ç†
                const paginatedResults = applyPagination(sortedResults);
                
                // æ›´æ–°é¡¯ç¤º
                updateResultsDisplay(paginatedResults);
                updateFilterCounts(results);
                updatePagination();
                
                // ä¿å­˜æœå°‹çµæœåˆ° sessionStorage
                try {
                    sessionStorage.setItem('lastSearchResults', JSON.stringify(results));
                    sessionStorage.setItem('lastSearchQuery', searchState.query);
                } catch (error) {
                    console.error('ç„¡æ³•ä¿å­˜æœå°‹çµæœ:', error);
                }
                
                showLoading(false);
                
                console.log(`æ‰¾åˆ° ${results.length} æœ¬ç›¸é—œæ›¸ç±`);
                
            } catch (error) {
                console.error('æœå°‹å¤±æ•—:', error);
                showError('æœå°‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
                showLoading(false);
            }
        }

        // å¥—ç”¨ç¯©é¸å™¨
        function applyFilters(results) {
            let filtered = [...results];
            
            // åƒ¹æ ¼ç¯©é¸
            if (searchState.filters.minPrice !== null) {
                filtered = filtered.filter(book => book.currentPrice >= searchState.filters.minPrice);
            }
            
            if (searchState.filters.maxPrice !== null) {
                filtered = filtered.filter(book => book.currentPrice <= searchState.filters.maxPrice);
            }
            
            return filtered;
        }

        // å¥—ç”¨æ’åº
        function applySorting(results) {
            const sorted = [...results];
            
            switch (searchState.sortBy) {
                case 'price':
                    return sorted.sort((a, b) => a.currentPrice - b.currentPrice);
                case 'date':
                    return sorted.sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate));
                case 'popularity':
                    return sorted.sort((a, b) => b.reviewCount - a.reviewCount);
                case 'relevance':
                default:
                    return sorted; // Google Books API å·²ç¶“æŒ‰ç›¸é—œæ€§æ’åº
            }
        }

        // å¥—ç”¨åˆ†é 
        function applyPagination(results) {
            const startIndex = (searchState.currentPage - 1) * searchState.pageSize;
            const endIndex = startIndex + searchState.pageSize;
            return results.slice(startIndex, endIndex);
        }

        // æ›´æ–°çµæœé¡¯ç¤º
        function updateResultsDisplay(results) {
            const grid = document.getElementById('productsGrid');
            
            if (results.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #666;">
                        <h3>ğŸ˜… æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„æ›¸ç±</h3>
                        <p>è«‹å˜—è©¦èª¿æ•´æœå°‹é—œéµå­—æˆ–ç¯©é¸æ¢ä»¶</p>
                        <button onclick="clearFilters()" style="margin-top: 15px; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">æ¸…é™¤ç¯©é¸æ¢ä»¶</button>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = results.map(book => `
                <div class="product-card" onclick="goToProduct('${book.id}')">
                    <div class="product-image">
                        ${book.discountRate ? `<div class="product-badge">${book.discountRate}</div>` : ''}
                        <img src="${book.imageUrl}" alt="${book.title}" 
                             onerror="this.style.display='none'; this.parentElement.innerHTML += '<div style=&quot;display: flex; align-items: center; justify-content: center; height: 100%; color: #999; font-size: 12px;&quot;>å°é¢åœ–ç‰‡</div>';">
                    </div>
                    <div class="product-info">
                        <div class="product-title" title="${book.title}">${book.title}</div>
                        <div class="product-author">${book.author}</div>
                        <div class="product-price">
                            <span class="current-price">$${book.currentPrice}</span>
                            ${book.originalPrice ? `<span class="original-price">$${book.originalPrice}</span>` : ''}
                            ${book.discountRate ? `<span class="discount-rate">${book.discountRate}</span>` : ''}
                        </div>
                        <div class="product-actions">
                            <button class="action-btn" onclick="event.stopPropagation(); previewBook('${book.id}')">è©¦é–±</button>
                            <button class="action-btn cart-btn" onclick="event.stopPropagation(); addToCart('${book.id}')">ğŸ›’</button>
                            <button class="action-btn" onclick="event.stopPropagation(); addToWishlist('${book.id}')">â™¡</button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // æ›´æ–°çµæœçµ±è¨ˆ
            document.getElementById('totalResults').textContent = searchState.totalResults;
        }

        // æ›´æ–°ç¯©é¸å™¨è¨ˆæ•¸
        function updateFilterCounts(results) {
            document.getElementById('allCount').textContent = results.length;
            
            // æ›¸ç±é¡å‹åˆ†é¡
            document.getElementById('chineseCount').textContent = results.filter(r => 
                r.language === 'ç¹é«”ä¸­æ–‡' || r.language === 'ä¸­æ–‡' || r.language === 'zh'
            ).length;
            
            document.getElementById('englishCount').textContent = results.filter(r => 
                r.language === 'en' || r.language === 'english' || r.language === 'è‹±æ–‡'
            ).length;
            
            document.getElementById('ebookCount').textContent = results.filter(r => 
                r.title.includes('é›»å­æ›¸') || r.categories.some(c => c.includes('é›»å­æ›¸'))
            ).length;
            
            document.getElementById('audiobookCount').textContent = results.filter(r => 
                r.title.includes('æœ‰è²æ›¸') || r.categories.some(c => c.includes('æœ‰è²æ›¸'))
            ).length;
            
            document.getElementById('magazineCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('é›œèªŒ') || c.includes('æœŸåˆŠ'))
            ).length;
            
            document.getElementById('textbookCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('æ•™ç§‘æ›¸') || c.includes('æ•™è‚²'))
            ).length;
            
            // æ–‡å­¸å°èªªåˆ†é¡
            const fictionBooks = results.filter(r => 
                r.categories.some(c => c.includes('æ–‡å­¸') || c.includes('å°èªª') || c.includes('Fiction'))
            );
            document.getElementById('fictionCount').textContent = fictionBooks.length;
            
            document.getElementById('chineseCreationCount').textContent = results.filter(r => 
                (r.language === 'ç¹é«”ä¸­æ–‡' || r.language === 'ä¸­æ–‡') && 
                r.categories.some(c => c.includes('æ–‡å­¸') || c.includes('å°èªª'))
            ).length;
            
            document.getElementById('translatedCount').textContent = results.filter(r => 
                r.translator && r.translator.trim() !== '' && 
                r.categories.some(c => c.includes('æ–‡å­¸') || c.includes('å°èªª'))
            ).length;
            
            document.getElementById('scifiCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('ç§‘å¹»') || c.includes('å¥‡å¹»') || c.includes('Fantasy') || c.includes('Science Fiction'))
            ).length;
            
            document.getElementById('mysteryCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('æ¨ç†') || c.includes('æ‡¸ç–‘') || c.includes('Mystery'))
            ).length;
            
            document.getElementById('romanceCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('æ„›æƒ…') || c.includes('Romance'))
            ).length;
            
            document.getElementById('historicalCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('æ­·å²') || c.includes('History')) && 
                r.categories.some(c => c.includes('å°èªª') || c.includes('Fiction'))
            ).length;
            
            // å•†æ¥­ç†è²¡åˆ†é¡
            const businessBooks = results.filter(r => 
                r.categories.some(c => c.includes('å•†æ¥­') || c.includes('ç†è²¡') || c.includes('Business') || c.includes('Economics'))
            );
            document.getElementById('businessCount').textContent = businessBooks.length;
            
            document.getElementById('investmentCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('æŠ•è³‡') || c.includes('ç†è²¡') || c.includes('Investment'))
            ).length;
            
            document.getElementById('workplaceCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('è·å ´') || c.includes('å·¥ä½œ') || c.includes('Career'))
            ).length;
            
            document.getElementById('marketingCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('è¡ŒéŠ·') || c.includes('ä¼ç®¡') || c.includes('Marketing') || c.includes('Management'))
            ).length;
            
            document.getElementById('economicsCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('ç¶“æ¿Ÿ') || c.includes('Economics'))
            ).length;
            
            // å¿ƒç†å‹µå¿—åˆ†é¡
            const psychologyBooks = results.filter(r => 
                r.categories.some(c => c.includes('å¿ƒç†') || c.includes('å‹µå¿—') || c.includes('Psychology') || c.includes('Self-Help'))
            );
            document.getElementById('psychologyCount').textContent = psychologyBooks.length;
            
            document.getElementById('psychologyBookCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('å¿ƒç†å­¸') || c.includes('Psychology'))
            ).length;
            
            document.getElementById('motivationCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('å‹µå¿—') || c.includes('æˆåŠŸ') || c.includes('Self-Help') || c.includes('Motivation'))
            ).length;
            
            document.getElementById('relationshipCount').textContent = results.filter(r => 
                r.categories.some(c => c.includes('äººéš›') || c.includes('é—œä¿‚') || c.includes('Relationship'))
            ).length;
        }

        // æ›´æ–°åˆ†é 
        function updatePagination() {
            const totalPages = Math.ceil(searchState.totalResults / searchState.pageSize);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }
            
            pagination.style.display = 'flex';
            
            let paginationHTML = '';
            
            // ä¸Šä¸€é 
            if (searchState.currentPage > 1) {
                paginationHTML += `<button class="page-btn" onclick="goToPage(${searchState.currentPage - 1})">ä¸Šä¸€é </button>`;
            }
            
            // é ç¢¼
            const startPage = Math.max(1, searchState.currentPage - 2);
            const endPage = Math.min(totalPages, searchState.currentPage + 2);
            
            if (startPage > 1) {
                paginationHTML += `<button class="page-btn" onclick="goToPage(1)">1</button>`;
                if (startPage > 2) {
                    paginationHTML += `<span>...</span>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `<button class="page-btn ${i === searchState.currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span>...</span>`;
                }
                paginationHTML += `<button class="page-btn" onclick="goToPage(${totalPages})">${totalPages}</button>`;
            }
            
            // ä¸‹ä¸€é 
            if (searchState.currentPage < totalPages) {
                paginationHTML += `<button class="page-btn" onclick="goToPage(${searchState.currentPage + 1})">ä¸‹ä¸€é </button>`;
            }
            
            pagination.innerHTML = paginationHTML;
            
            // æ›´æ–°é é¢è³‡è¨Š
            document.getElementById('currentPage').textContent = searchState.currentPage;
            document.getElementById('totalPages').textContent = totalPages;
        }

        // è·³è½‰é é¢
        function goToPage(page) {
            searchState.currentPage = page;
            executeSearch();
        }

        // æ’åºçµæœ
        function sortResults(sortBy, element) {
            searchState.sortBy = sortBy;
            searchState.currentPage = 1;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            
            executeSearch();
        }

        // å¥—ç”¨åƒ¹æ ¼ç¯©é¸
        function applyPriceFilter() {
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            
            searchState.filters.minPrice = minPrice ? parseInt(minPrice) : null;
            searchState.filters.maxPrice = maxPrice ? parseInt(maxPrice) : null;
            searchState.currentPage = 1;
            
            executeSearch();
        }

        // åˆ‡æ›ç¯©é¸å™¨
        function toggleFilter(filterType, element) {
            // é€™è£¡å¯ä»¥å¯¦ç¾æ›´è¤‡é›œçš„ç¯©é¸é‚è¼¯
            console.log('åˆ‡æ›ç¯©é¸å™¨:', filterType);
        }

        // è¨­å®šæª¢è¦–æ¨¡å¼
        function setView(viewType, element) {
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            
            const grid = document.getElementById('productsGrid');
            
            switch (viewType) {
                case 'list':
                    grid.style.gridTemplateColumns = '1fr';
                    break;
                case 'small':
                    grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(140px, 1fr))';
                    break;
                case 'grid':
                default:
                    grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(180px, 1fr))';
                    break;
            }
        }

        // æœå°‹é—œéµå­—æ¨™ç±¤
        function searchKeyword(keyword) {
            document.getElementById('searchInput').value = keyword;
            performSearch();
        }

        // ä¿®å¾©ç‰ˆæœå°‹çµæœé é¢è·³è½‰é‚è¼¯
        // æ›¿æ› search-results.html ä¸­çš„ç›¸é—œ JavaScript å‡½æ•¸

        // æ”¹é€²çš„è·³è½‰åˆ°å•†å“é é¢å‡½æ•¸
        function goToProduct(productId) {
            try {
                console.log('ğŸ”— æº–å‚™è·³è½‰åˆ°å•†å“é é¢:', productId);
                
                // ç¢ºä¿æœå°‹çµæœå·²è¼‰å…¥
                if (!searchState.results || searchState.results.length === 0) {
                    console.warn('âš ï¸ æ²’æœ‰æœå°‹çµæœï¼Œç„¡æ³•è·³è½‰');
                    showNotification('å•†å“è³‡æ–™è¼‰å…¥ä¸­ï¼Œè«‹ç¨å¾Œå†è©¦', 'warning');
                    return;
                }
                
                // å°‹æ‰¾å°æ‡‰çš„å•†å“è³‡æ–™
                const product = searchState.results.find(book => book.id === productId);
                if (!product) {
                    console.warn('âš ï¸ æ‰¾ä¸åˆ°å°æ‡‰çš„å•†å“è³‡æ–™:', productId);
                    showNotification('æ‰¾ä¸åˆ°å•†å“è³‡æ–™', 'warning');
                    return;
                }
                
                console.log('ğŸ“¦ æ‰¾åˆ°å•†å“:', product.title);
                
                // ä¿å­˜æœå°‹çµæœå’Œç•¶å‰å•†å“åˆ° sessionStorage
                try {
                    // ä¿å­˜å®Œæ•´çš„æœå°‹çµæœ
                    sessionStorage.setItem('lastSearchResults', JSON.stringify(searchState.results));
                    sessionStorage.setItem('lastSearchQuery', searchState.query);
                    sessionStorage.setItem('lastSearchCategory', searchState.category);
                    
                    // ä¿å­˜ç•¶å‰é¸ä¸­çš„å•†å“
                    sessionStorage.setItem('currentProduct', JSON.stringify(product));
                    
                    // ä¿å­˜è·³è½‰ä¾†æºè³‡è¨Š
                    sessionStorage.setItem('referrerPage', 'search-results');
                    sessionStorage.setItem('referrerUrl', window.location.href);
                    
                    console.log('ğŸ’¾ æœå°‹çµæœå·²ä¿å­˜åˆ° sessionStorage');
                    
                } catch (error) {
                    console.error('âŒ ä¿å­˜æœå°‹çµæœå¤±æ•—:', error);
                    // å³ä½¿ä¿å­˜å¤±æ•—ä¹Ÿè¦å˜—è©¦è·³è½‰
                }
                
                // è·³è½‰åˆ°å•†å“è©³æƒ…é é¢
                const productUrl = `product.html?id=${encodeURIComponent(productId)}`;
                console.log('ğŸš€ è·³è½‰åˆ°:', productUrl);
                window.location.href = productUrl;
                
            } catch (error) {
                console.error('âŒ è·³è½‰åˆ°å•†å“é é¢å¤±æ•—:', error);
                showNotification('é é¢è·³è½‰å¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
            }
        }

        // æ”¹é€²çš„æ›´æ–°çµæœé¡¯ç¤ºå‡½æ•¸
        function updateResultsDisplay(results) {
            const grid = document.getElementById('productsGrid');
            
            if (!grid) {
                console.error('âŒ æ‰¾ä¸åˆ°å•†å“ç¶²æ ¼å…ƒç´ ');
                return;
            }
            
            if (results.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #666;">
                        <h3>ğŸ˜… æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„æ›¸ç±</h3>
                        <p>è«‹å˜—è©¦èª¿æ•´æœå°‹é—œéµå­—æˆ–ç¯©é¸æ¢ä»¶</p>
                        <button onclick="clearFilters()" style="margin-top: 15px; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">æ¸…é™¤ç¯©é¸æ¢ä»¶</button>
                    </div>
                `;
                return;
            }
            
            try {
                grid.innerHTML = results.map((book, index) => {
                    // ç¢ºä¿æ¯æœ¬æ›¸éƒ½æœ‰å¿…è¦çš„è³‡æ–™
                    const safeBook = {
                        id: book.id || `book_${index}`,
                        title: book.title || 'æœªçŸ¥æ›¸å',
                        author: book.author || 'æœªçŸ¥ä½œè€…',
                        currentPrice: book.currentPrice || 299,
                        originalPrice: book.originalPrice || null,
                        discountRate: book.discountRate || null,
                        imageUrl: book.imageUrl || 'https://via.placeholder.com/300x400/f0f0f0/999999?text=æ›¸ç±å°é¢'
                    };
                    
                    return `
                        <div class="product-card" onclick="goToProduct('${safeBook.id}')" style="cursor: pointer;">
                            <div class="product-image">
                                ${safeBook.discountRate ? `<div class="product-badge">${safeBook.discountRate}</div>` : ''}
                                <img src="${safeBook.imageUrl}" 
                                    alt="${safeBook.title}" 
                                    loading="lazy"
                                    onerror="this.style.display='none'; this.parentElement.innerHTML += '<div style=&quot;display: flex; align-items: center; justify-content: center; height: 100%; color: #999; font-size: 12px;&quot;>å°é¢åœ–ç‰‡</div>';">
                            </div>
                            <div class="product-info">
                                <div class="product-title" title="${safeBook.title}">${safeBook.title}</div>
                                <div class="product-author">${safeBook.author}</div>
                                <div class="product-price">
                                    <span class="current-price">$${safeBook.currentPrice}</span>
                                    ${safeBook.originalPrice ? `<span class="original-price">$${safeBook.originalPrice}</span>` : ''}
                                    ${safeBook.discountRate ? `<span class="discount-rate">${safeBook.discountRate}</span>` : ''}
                                </div>
                                <div class="product-actions">
                                    <button class="action-btn" onclick="event.stopPropagation(); previewBook('${safeBook.id}')">è©¦é–±</button>
                                    <button class="action-btn cart-btn" onclick="event.stopPropagation(); addToCart('${safeBook.id}')">ğŸ›’</button>
                                    <button class="action-btn" onclick="event.stopPropagation(); addToWishlist('${safeBook.id}')">â™¡</button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // æ›´æ–°çµæœçµ±è¨ˆ
                document.getElementById('totalResults').textContent = searchState.totalResults;
                
                console.log(`âœ… é¡¯ç¤º ${results.length} æœ¬æ›¸ç±`);
                
            } catch (error) {
                console.error('âŒ æ›´æ–°çµæœé¡¯ç¤ºå¤±æ•—:', error);
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #666;">
                        <h3>âŒ é¡¯ç¤ºçµæœæ™‚ç™¼ç”ŸéŒ¯èª¤</h3>
                        <button onclick="executeSearch()" style="margin-top: 15px; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">é‡æ–°è¼‰å…¥</button>
                    </div>
                `;
            }
        }

        // æ”¹é€²çš„åŸ·è¡Œæœå°‹å‡½æ•¸
        async function executeSearch() {
            showLoading(true);
            
            try {
                console.log(`ğŸ” é–‹å§‹æœå°‹: "${searchState.query}" (åˆ†é¡: ${searchState.category})`);
                
                // æ§‹å»ºæœå°‹æŸ¥è©¢
                let searchQuery = searchState.query;
                
                // æ ¹æ“šåˆ†é¡èª¿æ•´æœå°‹
                if (searchState.category !== 'all') {
                    const categoryMap = {
                        'chinese': 'ä¸­æ–‡',
                        'english': 'english',
                        'ebook': 'ebook',
                        'magazine': 'magazine'
                    };
                    
                    if (categoryMap[searchState.category]) {
                        searchQuery += ` ${categoryMap[searchState.category]}`;
                    }
                }
                
                // ç¢ºä¿ Google Books API å·²æº–å‚™å°±ç·’
                if (!window.googleBooksAPI) {
                    throw new Error('Google Books API å°šæœªæº–å‚™å°±ç·’');
                }
                
                // åŸ·è¡Œæœå°‹
                const results = await window.googleBooksAPI.searchBooks(searchQuery, 40);
                
                if (!Array.isArray(results)) {
                    throw new Error('æœå°‹çµæœæ ¼å¼éŒ¯èª¤');
                }
                
                searchState.results = results;
                searchState.totalResults = results.length;
                
                console.log(`âœ… æœå°‹å®Œæˆï¼Œæ‰¾åˆ° ${results.length} æœ¬æ›¸ç±`);
                
                if (results.length === 0) {
                    // å¦‚æœæ²’æœ‰çµæœï¼Œå˜—è©¦ç°¡åŒ–æœå°‹
                    console.log('ğŸ”„ å˜—è©¦ç°¡åŒ–æœå°‹...');
                    const simpleQuery = searchState.query.split(' ')[0];
                    if (simpleQuery !== searchState.query) {
                        const simpleResults = await window.googleBooksAPI.searchBooks(simpleQuery, 20);
                        if (simpleResults.length > 0) {
                            searchState.results = simpleResults;
                            searchState.totalResults = simpleResults.length;
                            console.log(`âœ… ç°¡åŒ–æœå°‹æˆåŠŸï¼Œæ‰¾åˆ° ${simpleResults.length} æœ¬æ›¸ç±`);
                        }
                    }
                }
                
                // å¥—ç”¨ç¯©é¸å™¨å’Œæ’åº
                const filteredResults = applyFilters(searchState.results);
                const sortedResults = applySorting(filteredResults);
                const paginatedResults = applyPagination(sortedResults);
                
                // æ›´æ–°é¡¯ç¤º
                updateResultsDisplay(paginatedResults);
                updateFilterCounts(searchState.results);
                updatePagination();
                
                // ä¿å­˜æœå°‹çµæœ
                try {
                    sessionStorage.setItem('lastSearchResults', JSON.stringify(searchState.results));
                    sessionStorage.setItem('lastSearchQuery', searchState.query);
                    sessionStorage.setItem('lastSearchCategory', searchState.category);
                    console.log('ğŸ’¾ æœå°‹çµæœå·²ä¿å­˜');
                } catch (error) {
                    console.warn('âš ï¸ ä¿å­˜æœå°‹çµæœå¤±æ•—:', error);
                }
                
                showLoading(false);
                
            } catch (error) {
                console.error('âŒ æœå°‹åŸ·è¡Œå¤±æ•—:', error);
                showError(`æœå°‹å¤±æ•—ï¼š${error.message}`);
                showLoading(false);
            }
        }

        // æ”¹é€²çš„é è¦½æ›¸ç±å‡½æ•¸
        function previewBook(productId) {
            try {
                const book = searchState.results.find(b => b.id === productId);
                if (book && book.previewLink) {
                    console.log('ğŸ“– é–‹å•Ÿé è¦½:', book.title);
                    window.open(book.previewLink, '_blank', 'noopener,noreferrer');
                } else {
                    console.log('ğŸ“– æ­¤æ›¸ç±ç„¡é è¦½åŠŸèƒ½');
                    showNotification('ğŸ“– æ­¤æ›¸ç±æš«ç„¡é è¦½åŠŸèƒ½', 'info');
                }
            } catch (error) {
                console.error('âŒ é è¦½æ›¸ç±å¤±æ•—:', error);
                showNotification('é è¦½åŠŸèƒ½æš«æ™‚ç„¡æ³•ä½¿ç”¨', 'warning');
            }
        }

        // æ”¹é€²çš„åŠ å…¥è³¼ç‰©è»Šå‡½æ•¸
        function addToCart(productId) {
            try {
                const book = searchState.results.find(b => b.id === productId);
                if (!book) {
                    console.warn('âš ï¸ æ‰¾ä¸åˆ°å•†å“:', productId);
                    showNotification('æ‰¾ä¸åˆ°å•†å“è³‡æ–™', 'warning');
                    return;
                }
                
                let cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
                
                const existingItem = cartItems.find(item => item.id === book.id);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                    console.log('ğŸ“¦ å¢åŠ å•†å“æ•¸é‡:', book.title);
                } else {
                    cartItems.push({
                        id: book.id,
                        title: book.title,
                        price: book.currentPrice,
                        originalPrice: book.originalPrice,
                        note: book.note,
                        quantity: 1,
                        stock: 'æœ‰',
                        selected: true
                    });
                    console.log('ğŸ›’ åŠ å…¥è³¼ç‰©è»Š:', book.title);
                }
                
                localStorage.setItem('cartItems', JSON.stringify(cartItems));
                updateCartDisplay();
                
                showNotification(`âœ… ã€Œ${book.title}ã€å·²åŠ å…¥è³¼ç‰©è»Šï¼`, 'success');
                
            } catch (error) {
                console.error('âŒ åŠ å…¥è³¼ç‰©è»Šå¤±æ•—:', error);
                showNotification('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
            }
        }

        // æ”¹é€²çš„åŠ å…¥é¡˜æœ›æ¸…å–®å‡½æ•¸
        function addToWishlist(productId) {
            try {
                const book = searchState.results.find(b => b.id === productId);
                if (book) {
                    console.log('ğŸ’ åŠ å…¥é¡˜æœ›æ¸…å–®:', book.title);
                    showNotification(`ğŸ’ ã€Œ${book.title}ã€å·²åŠ å…¥ä¸‹æ¬¡å†è²·æ¸…å–®ï¼`, 'info');
                } else {
                    showNotification('æ‰¾ä¸åˆ°å•†å“è³‡æ–™', 'warning');
                }
            } catch (error) {
                console.error('âŒ åŠ å…¥é¡˜æœ›æ¸…å–®å¤±æ•—:', error);
                showNotification('åŠ å…¥é¡˜æœ›æ¸…å–®å¤±æ•—', 'warning');
            }
        }

        // æ”¹é€²çš„é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯å‡½æ•¸
        function showError(message) {
            const grid = document.getElementById('productsGrid');
            if (grid) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #666;">
                        <h3>âŒ ${message}</h3>
                        <p>è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦</p>
                        <button onclick="executeSearch()" style="margin-top: 15px; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">é‡æ–°æœå°‹</button>
                        <button onclick="window.location.href='index.html'" style="margin-top: 10px; margin-left: 10px; padding: 10px 20px; background-color: #666; color: white; border: none; border-radius: 4px; cursor: pointer;">è¿”å›é¦–é </button>
                    </div>
                `;
                grid.style.display = 'grid';
            }
        }

        // æ”¹é€²çš„åˆå§‹åŒ–é é¢å‡½æ•¸
        function initializePage() {
            try {
                console.log('ğŸš€ åˆå§‹åŒ–æœå°‹çµæœé é¢');
                
                checkLoginStatus();
                updateCartDisplay();
                
                // å¾ URL åƒæ•¸ç²å–æœå°‹æ¢ä»¶
                const urlParams = new URLSearchParams(window.location.search);
                const query = urlParams.get('q') || '';
                const category = urlParams.get('category') || 'all';
                
                console.log('ğŸ“‹ æœå°‹åƒæ•¸ - æŸ¥è©¢:', query, 'åˆ†é¡:', category);
                
                if (query) {
                    searchState.query = query;
                    searchState.category = category;
                    
                    // æ›´æ–°æœå°‹æ¡†
                    const searchInput = document.getElementById('searchInput');
                    const categorySelect = document.getElementById('searchCategory');
                    
                    if (searchInput) searchInput.value = query;
                    if (categorySelect) categorySelect.value = category;
                    
                    // æ›´æ–°é é¢æ¨™é¡Œå’ŒéºµåŒ…å±‘
                    document.getElementById('pageTitle').textContent = `"${query}" çš„æœå°‹çµæœ - æ›¸å®¢ä¾†ç·šä¸Šæ›¸åº—`;
                    document.getElementById('breadcrumbPath').textContent = `æœå°‹çµæœï¼š"${query}"`;
                    
                    // åŸ·è¡Œæœå°‹
                    executeSearch();
                } else {
                    console.log('ğŸ“ æ²’æœ‰æœå°‹æ¢ä»¶ï¼Œé¡¯ç¤ºæç¤º');
                    showNoSearchMessage();
                }
                
                console.log('âœ… é é¢åˆå§‹åŒ–å®Œæˆ');
                
            } catch (error) {
                console.error('âŒ é é¢åˆå§‹åŒ–å¤±æ•—:', error);
                showError('é é¢åˆå§‹åŒ–å¤±æ•—');
            }
        }

        // é è¦½æ›¸ç±
        function previewBook(productId) {
            const book = searchState.results.find(b => b.id === productId);
            if (book && book.previewLink) {
                window.open(book.previewLink, '_blank');
            } else {
                showNotification('ğŸ“– æ­¤æ›¸ç±æš«ç„¡é è¦½åŠŸèƒ½', 'info');
            }
        }

        // åŠ å…¥è³¼ç‰©è»Š
        function addToCart(productId) {
            const book = searchState.results.find(b => b.id === productId);
            if (!book) return;
            
            let cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
            
            const existingItem = cartItems.find(item => item.id === book.id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cartItems.push({
                    id: book.id,
                    title: book.title,
                    price: book.currentPrice,
                    originalPrice: book.originalPrice,
                    note: book.note,
                    quantity: 1,
                    stock: 'æœ‰',
                    selected: true
                });
            }
            
            localStorage.setItem('cartItems', JSON.stringify(cartItems));
            updateCartDisplay();
            
            showNotification(`âœ… ã€Œ${book.title}ã€å·²åŠ å…¥è³¼ç‰©è»Šï¼`, 'success');
        }

        // åŠ å…¥é¡˜æœ›æ¸…å–®
        function addToWishlist(productId) {
            const book = searchState.results.find(b => b.id === productId);
            if (book) {
                showNotification(`ğŸ’ ã€Œ${book.title}ã€å·²åŠ å…¥ä¸‹æ¬¡å†è²·æ¸…å–®ï¼`, 'info');
            }
        }

        // æ¸…é™¤ç¯©é¸æ¢ä»¶
        function clearFilters() {
            searchState.filters = {
                category: 'all',
                minPrice: null,
                maxPrice: null
            };
            searchState.currentPage = 1;
            
            document.getElementById('minPrice').value = '';
            document.getElementById('maxPrice').value = '';
            
            executeSearch();
        }

        // é¡¯ç¤ºè¼‰å…¥ä¸­
        function showLoading(show) {
            const loading = document.getElementById('loadingIndicator');
            const grid = document.getElementById('productsGrid');
            const pagination = document.getElementById('pagination');
            
            if (show) {
                loading.style.display = 'block';
                grid.style.display = 'none';
                pagination.style.display = 'none';
            } else {
                loading.style.display = 'none';
                grid.style.display = 'grid';
            }
        }

        // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        function showError(message) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #666;">
                    <h3>âŒ ${message}</h3>
                    <button onclick="executeSearch()" style="margin-top: 15px; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">é‡æ–°æœå°‹æ›¸ç±</button>
                </div>
            `;
            grid.style.display = 'grid';
        }

        // é¡¯ç¤ºç„¡æœå°‹æ¢ä»¶è¨Šæ¯
        function showNoSearchMessage() {
            showLoading(false);
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #666;">
                    <h3>ğŸ” è«‹è¼¸å…¥æœå°‹é—œéµå­—</h3>
                    <p>åœ¨ä¸Šæ–¹æœå°‹æ¡†è¼¸å…¥æ‚¨è¦æ‰¾çš„æ›¸ç±åç¨±ã€ä½œè€…æˆ–é—œéµå­—</p>
                    <button onclick="document.getElementById('searchInput').focus()" style="margin-top: 15px; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">é–‹å§‹æœå°‹æ›¸ç±</button>
                </div>
            `;
            grid.style.display = 'grid';
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const colors = {
                success: '#4CAF50',
                info: '#2196F3',
                warning: '#ff9800',
                error: '#f44336'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: ${colors[type]};
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                max-width: 300px;
                font-size: 14px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const userEmail = localStorage.getItem('userEmail');
            
            if (isLoggedIn === 'true' && userEmail) {
                document.getElementById('userInfo').textContent = `æ­¡è¿ï¼Œ${userEmail}`;
                document.getElementById('loginLogoutBtn').textContent = 'ç™»å‡º';
                document.getElementById('loginLogoutBtn').onclick = logout;
            }
        }

        // æ›´æ–°è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤º
        function updateCartDisplay() {
            const cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
            const cartCount = cartItems.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cartCount').textContent = cartCount;
        }

        // ç™»å‡ºåŠŸèƒ½
        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userEmail');
                localStorage.removeItem('loginTime');
                alert('å·²æˆåŠŸç™»å‡º');
                checkLoginStatus();
            }
        }

        // è™•ç†ç™»å…¥ç™»å‡º
        function handleLoginLogout() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn === 'true') {
                logout();
            } else {
                window.location.href = 'login.html';
            }
        }

        // å…¶ä»–å°èˆªåŠŸèƒ½
        function showOrders() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn !== 'true') {
                window.location.href = 'login.html?redirect=ordersearch.html';
                return;
            }
            window.location.href = 'ordersearch.html';
        }

        function showNewReleases() {
            alert('æ–°æ›¸æ¨è–¦é é¢é–‹ç™¼ä¸­...');
        }

        function showBestsellers() {
            alert('æš¢éŠ·æ¦œé é¢é–‹ç™¼ä¸­...');
        }

        function showEbooks() {
            alert('é›»å­æ›¸åŸé é¢é–‹ç™¼ä¸­...');
        }

        function toggleLanguage() {
            alert('èªè¨€åˆ‡æ›åŠŸèƒ½é–‹ç™¼ä¸­...');
        }

        // æœå°‹æ¡† Enter éµæ”¯æ´
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            console.log('æœå°‹çµæœé é¢å·²è¼‰å…¥å®Œæˆ');
        });
    </script>
</body>
</html>